<!DOCTYPE html>
<html lang="en-US" class="is-fullheight">

<!-- Mirrored from www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 31 Aug 2024 01:49:52 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="preconnect" href="https://fast.wistia.com/" crossorigin>
<link rel="shortcut icon" href="../../wp-content/themes/aqua3/favicon.ico" />
<link rel="icon" type="image/png" href="../../wp-content/themes/aqua3/favicon_192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" sizes="180x180" href="../../wp-content/themes/aqua3/apple-touch-icon-180x180.png" />

	<!-- Start cookieyes banner --> <script data-minify="1" id="cookieyes" type="text/javascript" src="../../wp-content/cache/min/1/client_data/5bcdbce45953e61e74b8da56/scriptff17.js?ver=1724591342"></script> <!-- End cookieyes banner -->
	
<meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />

	<!-- This site is optimized with the Yoast SEO plugin v23.3 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>Bucket Monopoly: Breaching AWS Accounts Through Shadow Resources</title><link rel="preload" data-rocket-preload as="image" href="../../wp-content/uploads/2024/07/bucket-monopoly-blog-main-image-1200x628-1.jpg" fetchpriority="high">
	<meta name="description" content="We discovered critical vulnerabilities in six AWS services that range between RCE, full account takeover, manipulation and more." />
	<link rel="canonical" href="index.html" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Bucket Monopoly: Breaching AWS Accounts Through Shadow Resources" />
	<meta property="og:description" content="We discovered critical vulnerabilities in six AWS services that range between RCE, full account takeover, manipulation and more." />
	<meta property="og:url" content="https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/" />
	<meta property="og:site_name" content="Aqua" />
	<meta property="article:publisher" content="https://www.facebook.com/AquaSecTeam" />
	<meta property="article:published_time" content="2024-08-09T19:13:35+00:00" />
	<meta property="article:modified_time" content="2024-08-29T10:52:37+00:00" />
	<meta property="og:image" content="https://www.aquasec.com/wp-content/uploads/2024/07/bucket-monopoly-blog-main-image-1200x628-1.jpg" />
	<meta property="og:image:width" content="1200" />
	<meta property="og:image:height" content="628" />
	<meta property="og:image:type" content="image/jpeg" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:creator" content="@AquaSecTeam" />
	<meta name="twitter:site" content="@AquaSecTeam" />
	<meta name="twitter:label1" content="Written by" />
	<meta name="twitter:data1" content="Ona Blanchette" />
	<meta name="twitter:label2" content="Est. reading time" />
	<meta name="twitter:data2" content="41 minutes" />
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":["Article","BlogPosting"],"@id":"https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/#article","isPartOf":{"@id":"https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/"},"author":{"name":"Ona Blanchette","@id":"https://www.aquasec.com/#/schema/person/185e29b064441d4036b87a2be8368f72"},"headline":"Bucket Monopoly: Breaching AWS Accounts Through Shadow Resources","datePublished":"2024-08-09T19:13:35+00:00","dateModified":"2024-08-29T10:52:37+00:00","mainEntityOfPage":{"@id":"https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/"},"wordCount":8219,"publisher":{"@id":"https://www.aquasec.com/#organization"},"image":{"@id":"https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/#primaryimage"},"thumbnailUrl":"https://www.aquasec.com/wp-content/uploads/2024/07/bucket-monopoly-blog-main-image-1200x628-1.jpg","articleSection":["SECURITY RESEARCH"],"inLanguage":"en-US"},{"@type":"WebPage","@id":"https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/","url":"https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/","name":"Bucket Monopoly: Breaching AWS Accounts Through Shadow Resources","isPartOf":{"@id":"https://www.aquasec.com/#website"},"primaryImageOfPage":{"@id":"https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/#primaryimage"},"image":{"@id":"https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/#primaryimage"},"thumbnailUrl":"https://www.aquasec.com/wp-content/uploads/2024/07/bucket-monopoly-blog-main-image-1200x628-1.jpg","datePublished":"2024-08-09T19:13:35+00:00","dateModified":"2024-08-29T10:52:37+00:00","description":"We discovered critical vulnerabilities in six AWS services that range between RCE, full account takeover, manipulation and more.","breadcrumb":{"@id":"https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/"]}]},{"@type":"ImageObject","inLanguage":"en-US","@id":"https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/#primaryimage","url":"https://www.aquasec.com/wp-content/uploads/2024/07/bucket-monopoly-blog-main-image-1200x628-1.jpg","contentUrl":"https://www.aquasec.com/wp-content/uploads/2024/07/bucket-monopoly-blog-main-image-1200x628-1.jpg","width":1200,"height":628},{"@type":"BreadcrumbList","@id":"https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://www.aquasec.com/"},{"@type":"ListItem","position":2,"name":"Bucket Monopoly: Breaching AWS Accounts Through Shadow Resources"}]},{"@type":"WebSite","@id":"https://www.aquasec.com/#website","url":"https://www.aquasec.com/","name":"Aqua","description":"Cloud Native Security, Container Security &amp; Serverless Security","publisher":{"@id":"https://www.aquasec.com/#organization"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://www.aquasec.com/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Organization","@id":"https://www.aquasec.com/#organization","name":"Aqua Security","url":"https://www.aquasec.com/","logo":{"@type":"ImageObject","inLanguage":"en-US","@id":"https://www.aquasec.com/#/schema/logo/image/","url":"https://www.aquasec.com/wp-content/uploads/2016/05/aqua_logo_fullcolor.png","contentUrl":"https://www.aquasec.com/wp-content/uploads/2016/05/aqua_logo_fullcolor.png","width":491,"height":177,"caption":"Aqua Security"},"image":{"@id":"https://www.aquasec.com/#/schema/logo/image/"},"sameAs":["https://www.facebook.com/AquaSecTeam","https://x.com/AquaSecTeam","https://www.instagram.com/aquaseclife/","https://www.linkedin.com/company/aquasecteam/","https://github.com/aquasecurity"]},{"@type":"Person","@id":"https://www.aquasec.com/#/schema/person/185e29b064441d4036b87a2be8368f72","name":"Ona Blanchette","url":"https://www.aquasec.com/author/ona/"}]}</script>
	<!-- / Yoast SEO plugin. -->



<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css' type='text/css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='main-style-css' href='../../wp-content/themes/aqua3/css/aqua3.mind4e9.css?ver=1.0.657' type='text/css' media='all' />
<script type="text/javascript" data-cookieconsent="ignore" src="../../wp-content/themes/aqua3/js/aqua3.mind4e9.js?ver=1.0.657" id="aqua3_js-js"></script>
<noscript><style id="rocket-lazyload-nojs-css">.rll-youtube-player, [data-lazy-src]{display:none !important;}</style></noscript><meta name="msvalidate.01" content="EB7D71A4041DC995BE2F2C787A9183FD" />
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../../www.googletagmanager.com/gtm5445.html?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5N9T3H');</script>
<!-- End Google Tag Manager -->
</head>

<body class="post-template-default single single-post postid-21174 single-format-standard">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5N9T3H" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
				
<div id="page-21174" class="post-page post-21174 post type-post status-publish format-standard has-post-thumbnail hentry category-research">

<!-- hero starts -->

<div class="hero_wrap with_borderline">
	<div class="hero header_wrap no_header_image">
		<div class="hero-head">
						<!-- header starts -->
	<div class="v2_header_navbar_wrap">
		<nav class="navbar is-fixed-top">

			<div class="header_topbar_wrap">
				<div class="container">
					<div class="header_topbar">
						<div class="columns is-multiline is-gapless">
														<div class="column is-12-desktop is-12-tablet topbar_right">
								<div class="topbar_links">
																			<a class="topbar_link is_featured is-hidden-mobile dl_event_click" href="index.html" data-dl-event="none" data-dl-category="none" data-dl-action="topbar featured" data-dl-label="Bucket Monopoly: Breaching AWS Accounts Through Shadow Resources">Bucket Monopoly: Breaching AWS Accounts Through Shadow Resources</a>
																																							<a href="https://cloud.aquasec.com/signin" target="_blank" class="topbar_link">Sign in</a>
																					<a href="../../about-us/contact-us/index.html"  class="topbar_link">Contact</a>
																					<a href="https://support.aquasec.com/support/home" target="_blank" class="topbar_link">Support</a>
																					<a href="../../about-us/careers/index.html"  class="topbar_link">We're hiring!</a>
											
																	</div><!-- topbar_links -->
							</div><!-- is-5 -->
						</div><!-- columns -->
					</div><!-- header_topbar-->
				</div><!-- container -->
			</div><!-- header_topbar_wrap -->


			<div class="container is-small">
				<div class="navbar-brand">
										<a class="navbar-item logo dl_event_click" href="../../index.html" title="Aqua Security" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="main" data-dl-label="Aqua Security Logo">Aqua Security</a>
					<div role="button" tabindex="0" class="navbar-burger burger" title="Menu"><span></span><span></span><span></span></div>
				</div>

				<div class="navigation_shadow main_navigation_shadow"></div>
				<div id="main-navigation-navbar" class="navbar-menu">

					<div class="navbar-start">

						
						

						<div class="navbar-item toplevel_item navbar-item-platform">
														<a class="navbar-link is-arrowless dl_event_click" data-toggle="dropdown" href="../../aqua-cloud-native-security-platform/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="main" data-dl-label="Platform">Platform</a>
													</div><!-- ends - platform -->

						<div class="navbar-item toplevel_item navbar-item-solutions">
														<a class="navbar-link is-arrowless dl_event_click" data-toggle="dropdown" href="../../solutions/aws-container-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="main" data-dl-label="Solutions">Solutions</a>
													</div><!-- ends - solutions -->


						
						<div class="navbar-item toplevel_item navbar-item-resources">
														<a class="navbar-link is-arrowless dl_event_click" data-toggle="dropdown" href="../../resources/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="main" data-dl-label="Resources">Resources</a>
													</div><!-- ends - resources -->
 

						<div class="navbar-item toplevel_item navbar-item-company">
														<a class="navbar-link is-arrowless dl_event_click" data-toggle="dropdown" href="../../about-us/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="main" data-dl-label="Company">Company</a>
													</div><!-- ends - company -->


						

							
							<div class="breaklevel_item with_arrow break-navbar-item-platform">Platform</div>
							<div id="navbar-dropdown-platform" class="navbar-dropdown navbar_dropdown_wrap nav_platform_wrap">
								<div class="container nav_container">
	<div class="columns is-gapl*ess is-marginless is-multiline">
		<div class="column is-3-widescreen is-3-desktop is-12-tablet white_bg_left_column">

			<div class="platform_leftctas_wrap fadeInUp">

							<a class="platform_main_left_cta" href="../../aqua-cloud-native-security-platform/index.html" >
					<div class="cta_pretitle">Aqua Platform</div>
					<div class="cta_title">Unified Cloud Security</div>
					<div class="cta_subtitle">Gain total lifecycle visibility, reduce risks and stop attacks with the most comprehensive, fully integrated Cloud Native Application Protection Platform (CNAPP)</div>
					<div class="button arrowlinkbutton is-royalblue cta_link">Platform overview</div>
				</a><!-- platform_main_left_cta -->
			

			</div><!-- platform_leftctas_wrap -->


							<div class="platform_left_cta_links fadeInUp animationDelay_1">
					<ul>
											<li><a class="button arrowlinkbutton is-royalblue link_item dl_event_click" href="../../integrations/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform_left_cta_links" data-dl-label="">All platform Integrations</a></li>
											<li><a class="button arrowlinkbutton is-royalblue link_item dl_event_click" href="../../demo/index.html" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform_left_cta_links" data-dl-label="">Aqua CNAPP in action</a></li>
										</ul>
				</div><!-- platform_leftctas_links -->
			

						<div class="opensource_left_cta is-hidden-mobile fadeInUp animationDelay_2">
					
									<div class="opensource_links_wrap">

														<div class="navbar_opensource_links_title"><a class="dl_event_click" href="../../products/open-source-projects/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform_opensource" data-dl-label="Aqua Open Source"><div class="button arrowlinkbutton is-royalblue">Aqua Open Source</div><div class="small_link_subtitle">Driving security innovation in the cloud native community</div></a></div>
							
							<ul class="columns is-multiline opensource_links">
															<li class="navbar-item menu_item_with_icon icon_trivy"><a class="dl_event_click" href="https://trivy.dev/" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform_opensource" data-dl-label="Trivy">Trivy</a></li>
															<li class="navbar-item menu_item_with_icon icon_tracee"><a class="dl_event_click" href="../../products/tracee/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform_opensource" data-dl-label="Tracee">Tracee</a></li>
													</ul>
					</div>
							</div><!-- opensource_left_cta -->
			

		</div><!-- is-3 -->

		<div class="column is-7-widescreen is-6-desktop is-12-tablet">

			<div class="columns is-multiline is-gap*less">
				<div class="column is-6-widescreen is-6-desktop is-12-tablet">
					
					<div class="v2_generic_links_wrap platform_links_wrap platform_shiftleft_links_wrap fadeInUp animationDelay_1">

												<div class="section nav_col">

							
																			<div class="v2_generic_links_title platform_links_title">Dev Security</div>
									
							

															<ul class="v2_generic_links platform_links">
																					<li><a class="dl_event_click" href="../../products/software-supply-chain-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform shiftleft" data-dl-label="Software Supply Chain Security">Software Supply Chain Security<div class="small_link_subtitle">Protect your code, tools, and processes</div></a></li>
																							<li><a class="dl_event_click" href="../../products/container-vulnerability-scanning/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform shiftleft" data-dl-label="Vulnerability Management">Vulnerability Management<div class="small_link_subtitle">Reduce vulnerability noise and fix issues fast</div></a></li>
																							<li><a class="dl_event_click" href="../../products/container-analysis/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform shiftleft" data-dl-label="Advanced Malware Protection">Advanced Malware Protection<div class="small_link_subtitle">Stop stealthy malware from dev to cloud</div></a></li>
																				</ul>
													</div>
						
					</div><!-- platform_shiftleft_links_wrap -->

				</div><!-- is-6 shiftleft -->
				<div class="column is-6-widescreen is-6-desktop is-12-tablet">


				<div class="v2_generic_links_wrap platform_links_wrap platform_shiftright_links_wrap fadeInUp animationDelay_2">

												<div class="section nav_col">


							
																			<div class="v2_generic_links_title platform_links_title">Cloud Security</div>
									
							

																<ul class="v2_generic_links platform_links">

																							<li><a class="dl_event_click" href="../../products/cwpp-cloud-workload-protection/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform shiftright" data-dl-label="Cloud Workload Protection (CWPP)">Cloud Workload Protection (CWPP)<div class="small_link_subtitle">Runtime protection for every cloud workload</div></a></li>
																									<li><a class="dl_event_click" href="../../products/cspm/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform shiftright" data-dl-label="Cloud Security Posture Management">Cloud Security Posture Management<div class="small_link_subtitle">Extend traditional CSPM with workload visibility</div></a></li>
																									<li><a class="dl_event_click" href="../../products/kubernetes-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform shiftright" data-dl-label="Kubernetes Security Posture Management">Kubernetes Security Posture Management<div class="small_link_subtitle">Holistic Kubernetes Security for the Enterprise</div></a></li>
																					</ul>
													</div>
						
					</div><!-- platform_shiftright_links_wrap -->

				</div><!-- is-6 shiftright -->



									<div class="column is-12-widescreen is-12-desktop is-12-tablet">
						<div class="platform_news_wrap is-hidden-mobile fadeInUp animationDelay_3">

															<div class="platform_news_title">What's New?</div>
							
							<ul class="platform_news">

																			<li><a class="dl_event_click" href="../securing-genai-safeguarding-llm-powered-applications-with-aqua/index.html" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform news" data-dl-label="Securing GenAI: Safeguarding LLM-Powered Applications">Securing GenAI: Safeguarding LLM-Powered Applications</a></li>
																					<li><a class="dl_event_click" href="../discover-cloud-security-issues-faster-with-event-based-scanning/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform news" data-dl-label="Discover Cloud Security Issues Faster with Event-based Scanning">Discover Cloud Security Issues Faster with Event-based Scanning</a></li>
																					<li><a class="dl_event_click" href="../elevating-security-protecting-containerized-workloads-on-mainframes/index.html" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform news" data-dl-label="Elevating Security: Protecting Containerized Workloads on Mainframes">Elevating Security: Protecting Containerized Workloads on Mainframes</a></li>
																					<li><a class="dl_event_click" href="../aws-kubernetes-security-and-compliance/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="platform news" data-dl-label="Elevating AWS Kubernetes Security and Compliance">Elevating AWS Kubernetes Security and Compliance</a></li>
																	</ul>

						</div><!-- platform_news_wrap -->
					</div><!-- is-12 -->
				


			</div><!-- columns -->



			


		</div><!-- is-6 -->



		<div class="column is-2-widescreen is-3-desktop is-hidden-mobile nav_col_wrap nav_cta_col white_bg_right_column v2_resource_card_column">
			<div class="section nav_col v2_resource_card_wrap fadeInUp animationDelay_3">

					<a href="https://info.aquasec.com/gartner_cnapp" target="_blank" class="card resource_link_card resource_item dl_promo_click" data-dl-id="21174" data-dl-name="The new Gartner® Market Guide for Cloud-Native Application Protection Platforms (CNAPP)" data-dl-creative="Research and Reports" data-dl-position="main menu platform cta">

		<div class="card-image resource_image_wrap"><img class="resource_image" src="../../wp-content/uploads/2024/04/Gartner-CNAPP-2024-thumb-2.jpg" alt="" loading="lazy" /></div>

		<div class="card-content">

			<div class="resource_type">Research and Reports</div>
			<div class="resource_title">The new Gartner® Market Guide for Cloud-Native Application Protection Platforms (CNAPP)</div>
			
			
			
		</div><!-- card-content -->

		<div class="card-footer">
			<div class="resource_arrowlink">Get the expert guide by Gartner</div>
					</div>

	</a><!-- resource-item -->



			</div><!-- nav_col -->
		</div><!-- column -->

	</div><!-- columns -->
</div><!-- nav_container -->								<div class="navigation_shadow dropdown_navigation_shadow"></div>
							</div><!-- navbar-dropdown -->

							<div class="breaklevel_item with_arrow break-navbar-item-solutions">Solutions</div>
							<div id="navbar-dropdown-solutions" class="navbar-dropdown navbar_dropdown_wrap nav_solutions_wrap">
								<div class="container nav_container">
	<div class="columns is-gapl*ess is-marginless is-multiline row-eq-height">
		
		<div class="column is-10-widescreen is-6-desktop is-12-tablet">

			
			<div class="columns is-multiline is-gap*less row-eq-height height-100">


			
				<div class="column is-4-widescreen is-5-desktop is-12-tablet white_bg_left_column">

					<div class="v2_generic_links_wrap solutions_links_wrap v2_usecases_links_wrap fadeInUp">

												<div class="section nav_col">


							
																			<div class="v2_generic_links_title solutions_links_title">Use Cases</div>
									
															
							
																<ul class="v2_generic_links solutions_links">

																							<li><a class="dl_event_click" href="../../products/container-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions usecases" data-dl-label="Container Security">Container Security<div class="small_link_subtitle">Modern container security for cloud native Apps</div></a></li>
																									<li><a class="dl_event_click" href="../../use-cases/cndr-cloud-native-detection-and-reponse/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions usecases" data-dl-label="Detection and Response">Detection and Response<div class="small_link_subtitle">Cloud native detection & Response (CNDR)</div></a></li>
																									<li><a class="dl_event_click" href="../../use-cases/multi-cloud-and-hybrid-cloud/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions usecases" data-dl-label="Hybrid-Cloud & Multi-Cloud">Hybrid-Cloud & Multi-Cloud<div class="small_link_subtitle">security for hybrid and multi-cloud deployments</div></a></li>
																									<li><a class="dl_event_click" href="../../use-cases/container-auditing-compliance/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions usecases" data-dl-label="Prove Compliance">Prove Compliance<div class="small_link_subtitle">Controls for PCI, HIPAA, GDPR, and beyond</div></a></li>
																									<li><a class="dl_event_click" href="../../use-cases/devops-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions usecases" data-dl-label="Automate DevSecOps">Automate DevSecOps<div class="small_link_subtitle">Security and speed without compromise</div></a></li>
																					</ul>
													</div>
						
					</div><!-- v2_usecases_links_wrap -->

				</div><!-- is-4 usecases -->




				<div class="column is-8-widescreen is-7-desktop is-12-tablet">

					<div class="v2_generic_links_wrap solutions_links_wrap fadeInUp animationDelay_1">
						<div class="columns is-multiline is-gapless">
							<div class="column is-12">

																											<a class="v2_generic_links_title solutions_links_title dl_event_click" href="../../solutions/aws-container-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions" data-dl-label="Solutions">Solutions</a>
																	
							</div><!-- is-12 -->


																<div class="column is-6-widescreen is-6-desktop is-12-tablet">
										<ul class="v2_generic_links solutions_links">

																											<li><a class="dl_event_click" href="../../solutions/docker-container-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions" data-dl-label="Docker Security">Docker Security<div class="small_link_subtitle">Enterprise-Grade security for Docker environments</div></a></li>
																													<li><a class="dl_event_click" href="../../solutions/aws-container-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions" data-dl-label="AWS Cloud Security">AWS Cloud Security<div class="small_link_subtitle">Protect cloud native workloads on AWS</div></a></li>
																													<li><a class="dl_event_click" href="../../solutions/google-cloud-kubernetes-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions" data-dl-label="Google Cloud Security">Google Cloud Security<div class="small_link_subtitle">Secure K8s apps on Google Cloud Platform</div></a></li>
																															</ul>
																</div><!-- column is-6 -->
																<div class="column is-6-widescreen is-6-desktop is-12-tablet">
																	<ul class="v2_generic_links solutions_links">
																														<li><a class="dl_event_click" href="../../solutions/red-hat-openshift-container-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions" data-dl-label="OpenShift Security">OpenShift Security<div class="small_link_subtitle">Cloud Native Security for Red Hat OpenShift </div></a></li>
																													<li><a class="dl_event_click" href="../../solutions/vmware-tanzu/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions" data-dl-label="VMware Tanzu Security">VMware Tanzu Security<div class="small_link_subtitle">Native security across VMware Tanzu</div></a></li>
																													<li><a class="dl_event_click" href="../../solutions/azure-container-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="solutions" data-dl-label="Azure Cloud Security">Azure Cloud Security<div class="small_link_subtitle">Full Lifecycle Security for Azure Container Workloads</div></a></li>
																								</ul><!-- solutions links -->
									</div><!-- is-6 solutions -->
								
						</div><!-- columns -->
					</div><!-- solutions_links_wrap -->



					<div class="v2_generic_links_wrap verticals_links_wrap fadeInUp animationDelay_1">
						<div class="columns is-multiline is-gapless">
							<div class="column is-12">

																											<a class="v2_generic_links_title verticals_links_title dl_event_click" href="../../solutions/federal/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="verticals" data-dl-label="Industry">Industry</a>
																	
							</div><!-- is-12 -->


																<div class="column is-6-widescreen is-6-desktop is-12-tablet">
										<ul class="v2_generic_links verticals_links">

																											<li><a class="dl_event_click" href="../../solutions/federal/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="verticals" data-dl-label="Federal">Federal<div class="small_link_subtitle">CNAPP solution for Federal Government</div></a></li>
																															</ul>
																</div><!-- column is-6 -->
																<div class="column is-6-widescreen is-6-desktop is-12-tablet">
																	<ul class="v2_generic_links verticals_links">
																														<li><a class="dl_event_click" href="../../solutions/finance/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="verticals" data-dl-label="Financial Services">Financial Services<div class="small_link_subtitle">One platform for financial services</div></a></li>
																								</ul><!-- verticals links -->
									</div><!-- is-6 verticals -->
								
						</div><!-- columns -->
					</div><!-- verticals_links_wrap -->


				</div><!-- is-8 solutions links -->

			</div><!-- columns -->
			



		</div><!-- is-6 -->



		<div class="column is-2-widescreen is-3-desktop is-hidden-mobile nav_col_wrap nav_cta_col white_bg_right_column v2_resource_card_column">
			<div class="section nav_col v2_resource_card_wrap fadeInUp animationDelay_2">

					<a href="https://info.aquasec.com/aws-misconfigurations" target="_blank" class="card resource_link_card resource_item dl_promo_click" data-dl-id="21174" data-dl-name="The 15 Riskiest AWS Misconfigurations" data-dl-creative="Whitepaper" data-dl-position="main menu solutions cta">

		<div class="card-image resource_image_wrap"><img class="resource_image" src="../../wp-content/uploads/2021/01/15-misfigs-Resources-thumbnail-1.jpg" alt="" loading="lazy" /></div>

		<div class="card-content">

			<div class="resource_type">Whitepaper</div>
			<div class="resource_title">The 15 Riskiest AWS Misconfigurations</div>
			
			
			
		</div><!-- card-content -->

		<div class="card-footer">
			<div class="resource_arrowlink">Download Now</div>
					</div>

	</a><!-- resource-item -->




			</div><!-- nav_col -->
		</div><!-- column -->

	</div><!-- columns -->
</div><!-- nav_container -->								<div class="navigation_shadow dropdown_navigation_shadow"></div>
							</div><!-- navbar-dropdown -->

							
							<div class="breaklevel_item with_arrow break-navbar-item-resources">Resources</div>
							<div id="navbar-dropdown-resources" class="navbar-dropdown navbar_dropdown_wrap nav_resources_wrap">
								<div class="container nav_container">
	<div class="columns is-gapl*ess is-marginless is-multiline">

		<div class="column is-3-widescreen is-3-desktop is-12-tablet white_bg_left_column">

			<div class="resources_leftctas_wrap fadeInUp">

							<a class="resources_main_left_cta" href="../index.html" >
					<div class="cta_pretitle">The best of cloud native</div>
					<div class="cta_title">Aqua Blog</div>
					<div class="cta_subtitle">Expert insight, best practices and advice on cloud native security, trends, threat intelligence and compliance</div>
					<div class="button arrowlinkbutton is-royalblue cta_link">Read the Blog</div>
				</a><!-- resources_main_left_cta -->
							



			</div><!-- resources_leftctas_wrap -->


							<div class="resources_left_cta_links fadeInUp animationDelay_1">
					<ul>
											<li><a class="button arrowlinkbutton is-royalblue link_item dl_event_click" href="../sec-vs-solarwinds-ciso/index.html" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources_left_cta_links" data-dl-label="SEC vs. SolarWinds: A Cybersecurity Game Changer for CISOs">SEC vs. SolarWinds: A Cybersecurity Game Changer for CISOs</a></li>
											<li><a class="button arrowlinkbutton is-royalblue link_item dl_event_click" href="../accenture-and-aqua-partner-to-empower-cloud-security/index.html" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources_left_cta_links" data-dl-label="Accenture and Aqua Partner to Empower Cloud Security">Accenture and Aqua Partner to Empower Cloud Security</a></li>
										</ul>
				</div><!-- resources_leftctas_links -->
			


		</div><!-- is-3 -->


		<div class="column is-6-widescreen is-6-desktop is-12-tablet">

			<div class="columns is-multiline is-gap*less">

				<div class="column is-6-widescreen is-6-desktop is-12-tablet">

					<div class="v2_generic_links_wrap resources_links_wrap v2_resources_resources_links_wrap fadeInUp animationDelay_1">

												<div class="section nav_col">


							
																			<div class="v2_generic_links_title resources_links_title">Resources</div>
									
							
																<ul class="v2_generic_links resources_links">

																							<li><a class="dl_event_click" href="../../resources/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources resources" data-dl-label="Resources Center">Resources Center<div class="small_link_subtitle">eBooks, Data sheets, Whitepapers, Webinars, and much more</div></a></li>
																									<li><a class="dl_event_click" href="../../resources/virtual-container-security-channel/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources resources" data-dl-label="The Cloud Native Channel">The Cloud Native Channel<div class="small_link_subtitle">Cloud native security webinars & videos</div></a></li>
																									<li><a class="dl_event_click" href="https://aquademy.aquasec.com/"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources resources" data-dl-label="Aquademy">Aquademy<div class="small_link_subtitle">The Aqua academy</div></a></li>
																					</ul>
													</div>
						
					</div><!-- v2_resources_resources_links_wrap -->

				</div><!-- is-6 resources -->


				<div class="column is-6-widescreen is-6-desktop is-12-tablet">

					<div class="v2_generic_links_wrap resources_links_wrap v2_resources_wiki_links_wrap">

												<div class="section nav_col">


							
								
																<ul class="v2_generic_links resources_links fadeInUp animationDelay_3">

																							<li><a class="dl_event_click" href="../../cloud-native-academy/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources wiki" data-dl-label="Cloud Native Wiki"><span class="wiki_link_icon"></span>Cloud Native Wiki<div class="small_link_subtitle">The educational center for everything cloud native</div></a></li>
																									<li><a class="dl_event_click" href="../../cloud-native-academy/docker-container/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources wiki" data-dl-label="Docker Containers">Docker Containers</a></li>
																									<li><a class="dl_event_click" href="../../cloud-native-academy/supply-chain-security/supply-chain-security-mitigating-the-supply-chain-threat/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources wiki" data-dl-label="Software supply chain security">Software supply chain security</a></li>
																									<li><a class="dl_event_click" href="../../cloud-native-academy/cspm/cloud-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources wiki" data-dl-label="Cloud security">Cloud security</a></li>
																									<li><a class="dl_event_click" href="../../cloud-native-academy/kubernetes-101/kubernetes-complete-guide/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources wiki" data-dl-label="Kubernetes">Kubernetes</a></li>
																									<li><a class="dl_event_click" href="../../cloud-native-academy/application-security/application-security/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources wiki" data-dl-label="Application Security">Application Security</a></li>
																									<li><a class="dl_event_click" href="../../cloud-native-academy/devsecops/devsecops/index.html" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="resources wiki" data-dl-label="DevSecOps">DevSecOps</a></li>
																					</ul>
													</div>
						
					</div><!-- v2_resources_wiki_links_wrap -->

				</div><!-- is-6 wiki -->


							


			</div><!-- columns -->
			
		</div><!-- is-9 -->


		<div class="column is-3-desktop is-12-tablet is-hidden-mobile white_bg_right_column">

			<div class="research_section_wrap">

			<a href="../../research/index.html" class="research_cta fadeInUp animationDelay_4" target="_blank">
											<img src="../../wp-content/uploads/2019/08/Horizontal-Dark-Abyss.svg" alt="" class="research_cta_logo" width="100" height="115" />
					

											<div class="subtitle research_cta_title">Aqua research team</div>
					
											<div class="subtitle research_cta_subtitle">Security research focused on the cloud native stack to identify new threats and attack vectors</div>
					
					<div class="button arrowlinkbutton is-royalblue research_cta_button" target="_blank">More security research </div>
			</a><!-- research_cta -->
										<div class="research_latest_wrap fadeInUp animationDelay_5">

						<a href="https://info.aquasec.com/2023-cloud-native-threat-report" class="research_latest_link" target="_blank">
							<span class="research_latest_report_title">2023 Annual Aqua Nautilus Research</span><br />A Comprehensive Cloud Native Threat Report						</a>
						</div><!-- research_latest -->
						
			</div><!-- research_section_wrap -->
		</div><!-- column -->


	</div><!-- columns -->
</div><!-- nav_container -->								<div class="navigation_shadow dropdown_navigation_shadow"></div>
							</div><!-- navbar-dropdown -->

							<div class="breaklevel_item with_arrow break-navbar-item-company">Company</div>
							<div id="navbar-dropdown-company" class="navbar-dropdown navbar_dropdown_wrap nav_company_wrap">
								<div class="container nav_container">
	<div class="columns is-gap*less is-marginless">
		

		<div class="column is-3-widescreen is-3-desktop is-12-tablet white_bg_left_column">
		
			


							

									<div class="company_left_awards_title fadeInUp animationDelay_1">Recognized Leadership</div>
				
				<div class="v2_generic_links_wrap company_left_awards fadeInUp animationDelay_1">
					<ul class="v2_generic_links awards_links">
											<li><a class="award_item dl_event_click" href="https://info.aquasec.com/ciso-choice-awards?utm_source=zoom&amp;utm_campaign=cwpp&amp;utm_content=ciso_awards" target="_blank"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_left_awards" data-dl-label="CISO Choice Awards">
							<div class="award_title">CISO Choice Awards</div>
							<div class="award_details">Winner for Cloud Workload Protection Platform (CWPP)</div>
						</a></li>
											<li><a class="award_item dl_event_click" href="https://info.aquasec.com/forrester-tei" target="_blank"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_left_awards" data-dl-label="Forrester Consulting: The Total Economic Impact™ of Aqua CNAPP">
							<div class="award_title">Forrester Consulting: The Total Economic Impact™ of Aqua CNAPP</div>
							<div class="award_details">90% Reduction in vulnerability research and detection time</div>
						</a></li>
											<li><a class="award_item dl_event_click" href="https://info.aquasec.com/frost-sullivan-cnapp" target="_blank"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_left_awards" data-dl-label="Frost & Sullivan CNAPP report">
							<div class="award_title">Frost & Sullivan CNAPP report</div>
							<div class="award_details">Top innovation leader</div>
						</a></li>
										</ul>
				</div><!-- company_left_awards -->
			


			

		</div><!-- is-3 -->


		<div class="column is-6-widescreen is-6-desktop is-12-tablet">


			<div class="v2_generic_links_wrap company_links_wrap  fadeInUp animationDelay_2">
				<div class="columns is-multiline is-gapless">
					<div class="column is-12">

						
					</div><!-- is-12 -->


												<div class="column is-6-widescreen is-6-desktop is-12-tablet">
								<ul class="v2_generic_links company_links">

																							<li><a class="dl_event_click" href="../../about-us/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company" data-dl-label="About Us">About Us</a></li>
																									<li><a class="dl_event_click" href="../../customers/index.html" target="_self" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company" data-dl-label="Customers">Customers</a></li>
																									<li><a class="dl_event_click" href="../../partners/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company" data-dl-label="Partners">Partners</a></li>
																									<li><a class="dl_event_click" href="../../about-us/news/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company" data-dl-label="Newsroom">Newsroom</a></li>
																											</ul>
														</div><!-- column is-6 -->
														<div class="column is-6-widescreen is-6-desktop is-12-tablet">
															<ul class="v2_generic_links company_links">
																										<li><a class="dl_event_click" href="../../events/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company" data-dl-label="Upcoming Events">Upcoming Events</a></li>
																									<li><a class="dl_event_click" href="../../careers/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company" data-dl-label="Careers">Careers</a></li>
																									<li><a class="dl_event_click" href="https://success.aquasec.com/"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company" data-dl-label="Support">Support</a></li>
																									<li><a class="dl_event_click" href="../../services/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company" data-dl-label="Services">Services</a></li>
																				</ul><!-- company links -->
							</div><!-- is-6 company -->
								
													<div class="column is-12-widescreen is-12-desktop is-12-tablet">
								<div class="contactdetails_links_wrap  fadeInUp animationDelay_3">
		
																			<div class="contactdetails_links_title">Connect</div>
											
									<ul class="contactdetails_links">
																					<li class="navbar-item menu_item_with_icon icon_mail"><a class="dl_event_click" href="../../about-us/contact-us/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_contact" data-dl-label="Contact">Contact</a></li>
																					<li class="navbar-item menu_item_with_icon icon_twitter"><a class="dl_event_click" href="https://x.com/AquaSecurityHQ" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_contact" data-dl-label="Twitter">Twitter</a></li>
																					<li class="navbar-item menu_item_with_icon icon_facebook"><a class="dl_event_click" href="https://www.facebook.com/AquaSecTeam" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_contact" data-dl-label="Facebook">Facebook</a></li>
																					<li class="navbar-item menu_item_with_icon icon_linkedin"><a class="dl_event_click" href="https://www.linkedin.com/company/aquasecteam" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_contact" data-dl-label="Linkedin">Linkedin</a></li>
																					<li class="navbar-item menu_item_with_icon icon_instagram"><a class="dl_event_click" href="https://www.instagram.com/aquaseclife/" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_contact" data-dl-label="Instagram">Instagram</a></li>
																			</ul>
		
								</div><!-- contactdetails_links_wrap -->
							</div><!-- is-12 -->
						
				</div><!-- columns -->
			</div><!-- company_links_wrap -->

		</div><!-- is-8 -->

		<div class="column is-3-widescreen is-4-desktop is-hidden-mobile white_bg_right_column company_recent_news_wrap">
								<div class="v2_generic_links_wrap company_links_wrap fadeInUp animationDelay_4">
					<div class="section nav_col">
								<a class="v2_generic_links_title company_links_title dl_event_click" href="../../about-us/news/index.html"  data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_news" data-dl-label="News">News</a>
		
		<div class="newsroom_items_wrap">
					
									<a class="newsroom_item dl_event_click" href="../../news/gartner-cnapp-2024/index.html" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_news" data-dl-label="Aqua Security Named a Representative Vendor in the 2024 Gartner® Market Guide for Cloud-Native Application Protection Platforms (CNAPP)">
											<div class="newsroom_image"><img width="140" height="140" src="../../wp-content/themes/aqua3/images/aqua_default_140x140.png" alt="Aqua logo" loading="lazy"></div>
						<div class="newsroom_title"><div>Aqua Security Named a Representative Vendor in the 2024 Gartner® Market Guide for Cloud-Native Application Protection Platforms (CNAPP)</div></div>
					</a>
					
									<a class="newsroom_item dl_event_click" href="https://www.csoonline.com/article/3484842/s3-shadow-buckets-leave-aws-accounts-open-to-compromise.html/amp/" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_news" data-dl-label="S3 shadow buckets leave AWS accounts open to compromise">
											<div class="newsroom_image"><img width="140" height="140" src="../../wp-content/uploads/2023/09/Newsroom-logos-CSO-140x140.jpg" class="attachment-140x140 size-140x140 wp-post-image" alt="" loading="lazy" decoding="async" srcset="https://www.aquasec.com/wp-content/uploads/2023/09/Newsroom-logos-CSO-140x140.jpg 140w, https://www.aquasec.com/wp-content/uploads/2023/09/Newsroom-logos-CSO-150x150.jpg 150w, https://www.aquasec.com/wp-content/uploads/2023/09/Newsroom-logos-CSO.jpg 200w" sizes="(max-width: 140px) 100vw, 140px" /></div>
						<div class="newsroom_title"><div>S3 shadow buckets leave AWS accounts open to compromise</div></div>
					</a>
					
									<a class="newsroom_item dl_event_click" href="../../news/traceeshark-open-source-tool/index.html" target="_blank" data-dl-event="menu_click" data-dl-category="menu" data-dl-action="company_news" data-dl-label="Aqua Security Unveils Traceeshark: Open Source Tool Combining Tracee’s Dynamic Analysis of Linux Malware with Wireshark">
											<div class="newsroom_image"><img width="140" height="140" src="../../wp-content/themes/aqua3/images/aqua_default_140x140.png" alt="Aqua logo" loading="lazy"></div>
						<div class="newsroom_title"><div>Aqua Security Unveils Traceeshark: Open Source Tool Combining Tracee’s Dynamic Analysis of Linux Malware with Wireshark</div></div>
					</a>
			</div><!-- newsroom_items_wrap -->	 
	
						</div>
				</div>

		</div><!-- is-4 -->

	</div><!-- columns -->
</div><!-- nav_container -->
								<div class="navigation_shadow dropdown_navigation_shadow"></div>
							</div><!-- navbar-dropdown -->

						

					</div><!-- navbar-start -->


					<div class="navbar-end">

						<!-- nav_rightmenu starts -->

												<div class="navbar-item search_box">Search</div>

												<div class="navbar-item">
							<div class="field is-grouped">
																	<p class="control">
								
									
																			<a href="../../demo/index.html"  class="button is-primary type_btn dl_event_click" data-dl-event="trial_header" data-dl-category="trial" data-dl-action="click button" data-dl-label="header_right_menu_button">Get Started</a>
																		
																	</p>
								
																						</div>
						</div><!-- navbar-item -->
					<!-- nav_rightmenu ends -->


					</div><!-- navbar-end -->


					
						<div class="search_box_wrap">
							<div class="search_box_target">
																															</div><!-- search_box_target -->
							<div class="search_box_close"></div>
						</div><!-- search_box_wrap -->

					
				</div><!-- main-navigation-navbar -->


			</div><!-- container -->

			
		</nav>
	</div><!-- v2_header_navbar_wrap -->


	
<script type="text/javascript">
var $jnv1 = jQuery.noConflict();
$jnv1(document).ready(function(){

	// main menu
	$jnv1('.v2_header_navbar_wrap .navbar-burger').on('click', function() {
		$jnv1(this).toggleClass('is-active');
		$jnv1('.v2_header_navbar_wrap .navbar-menu').toggleClass('is-active');
		$jnv1('html').toggleClass('scroll-disable');
	});

		$jnv1('.navbar-item-platform,#navbar-dropdown-platform:not(.break_show-dropdown)').hover(function() {
		$jnv1('.navbar-item-platform').addClass('show-hover');
		$jnv1('#navbar-dropdown-platform').addClass('show-dropdown animated');
	}, function() {
		$jnv1('.navbar-item-platform').removeClass('show-hover');
		$jnv1('#navbar-dropdown-platform').removeClass('show-dropdown animated');
	});

	$jnv1('.break-navbar-item-platform').on('click', function() {
		$jnv1(this).toggleClass('break_is-active');
		$jnv1('#navbar-dropdown-platform').toggleClass('break_show-dropdown');
	});

	$jnv1('.navbar-item-solutions,#navbar-dropdown-solutions:not(.break_show-dropdown)').hover(function() {
		$jnv1('.navbar-item-solutions').addClass('show-hover');
		$jnv1('#navbar-dropdown-solutions').addClass('show-dropdown animated');
	}, function() {
		$jnv1('.navbar-item-solutions').removeClass('show-hover');
		$jnv1('#navbar-dropdown-solutions').removeClass('show-dropdown animated');
	});

	$jnv1('.break-navbar-item-solutions').on('click', function() {
		$jnv1(this).toggleClass('break_is-active');
		$jnv1('#navbar-dropdown-solutions').toggleClass('break_show-dropdown');
	});
			
			
	$jnv1('.navbar-item-resources,#navbar-dropdown-resources:not(.break_show-dropdown)').hover(function() {
		$jnv1('.navbar-item-resources').addClass('show-hover');
		$jnv1('#navbar-dropdown-resources').addClass('show-dropdown animated');
	}, function() {
		$jnv1('.navbar-item-resources').removeClass('show-hover');
		$jnv1('#navbar-dropdown-resources').removeClass('show-dropdown animated');
	});

	$jnv1('.break-navbar-item-resources').on('click', function() {
		$jnv1(this).toggleClass('break_is-active');
		$jnv1('#navbar-dropdown-resources').toggleClass('break_show-dropdown');
	});


			

	$jnv1('.navbar-item-company,#navbar-dropdown-company:not(.break_show-dropdown)').hover(function() {
		$jnv1('.navbar-item-company').addClass('show-hover');
		$jnv1('#navbar-dropdown-company').addClass('show-dropdown animated');
	}, function() {
		$jnv1('.navbar-item-company').removeClass('show-hover');
		$jnv1('#navbar-dropdown-company').removeClass('show-dropdown animated');
	});

	$jnv1('.break-navbar-item-company').on('click', function() {
		$jnv1(this).toggleClass('break_is-active');
		$jnv1('#navbar-dropdown-company').toggleClass('break_show-dropdown');
	});


});
</script>		</div><!-- hero-head -->

		
		<div class="hero-foot">
					</div><!-- hero-foot -->

	</div><!-- hero -->

	
	
	

</div><!-- hero_wrap --><!-- hero ends -->

<div class="post_pagewrap with_toc">		<!-- blog header title starts -->
									<div class="section header_title_wrap anima*table">
					<div class="container">
						<div class="header_title_content_wrap match_blog_width">
							
							<a href="../index.html" class="page_label has_left_arrow fadeInUp">Aqua Blog</a>	
							<h1 class="title page_title fadeInUp">Bucket Monopoly: Breaching AWS Accounts Through Shadow Resources</h1>
														

							
							<div class="post_meta">
								<div class="post_author_info"><div class="avatars_wrap"><a href="../../authors/yakir-kadkoda/index.html" class="avatar_wrap"><div class="author_avatar" style="background-image:url(../../wp-content/uploads/2024/01/Yakir-K-140x140.jpg);"></div></a><a href="../../authors/ofek-itach/index.html" class="avatar_wrap"><div class="author_avatar" style="background-image:url(../../wp-content/uploads/2024/01/Ofek-Itach_SQ-140x140.jpg);"></div></a><a href="../../authors/michael-katchinskiy/index.html" class="avatar_wrap"><div class="author_avatar" style="background-image:url(../../wp-content/uploads/2024/01/Michael-Katchinskiy-140x140.jpg);"></div></a></div><div class="names_wrap"><a href="../../authors/yakir-kadkoda/index.html" class="name_wrap">Yakir Kadkoda</a><a href="../../authors/ofek-itach/index.html" class="name_wrap">Ofek Itach</a><a href="../../authors/michael-katchinskiy/index.html" class="name_wrap">Michael Katchinskiy</a><div class="post_date">August 9, 2024</div></div></div></div><!-- post_meta -->

						</div><!-- header_title_content_wrap -->

													<div class="post_cover_image">
								<div class="match_blog_width">
									<img fetchpriority="high" src="../../wp-content/uploads/2024/07/bucket-monopoly-blog-main-image-1200x628-1.jpg" alt="Bucket Monopoly: Breaching AWS Accounts Through Shadow Resources" width="850" height="450" />
								</div>
							</div>
						
					</div><!-- container -->
				</div><!-- header_title_wrap -->
		<!-- blog header title ends -->

	<!-- content starts -->
	
	<div class="section content_wrap main_content_wrap">
		<div class="container">
			<div class="main_content_column match_blog_width">
				<div class="content">
					
					<p><span data-contrast="auto">During February 2024, we discovered critical vulnerabilities in six AWS services. The impact of these vulnerabilities range between remote code execution (RCE)<span class="NormalTextRun SCXW61824672 BCX0">, </span><span class="NormalTextRun CommentStart CommentHighlightPipeRestV2 CommentHighlightRest SCXW61824672 BCX0">full-service</span><span class="NormalTextRun CommentHighlightRest SCXW61824672 BCX0"> user</span><span class="NormalTextRun CommentHighlightRest SCXW61824672 BCX0"> takeover</span><span class="NormalTextRun CommentHighlightRest SCXW61824672 BCX0"> (</span><span class="NormalTextRun ContextualSpellingAndGrammarErrorV2Themed CommentHighlightRest SCXW61824672 BCX0">which</span><span class="NormalTextRun CommentHighlightRest SCXW61824672 BCX0"> might provide</span> <span class="NormalTextRun CommentHighlightRest SCXW61824672 BCX0">powerful administrative access)</span><span class="NormalTextRun CommentHighlightPipeRestV2 SCXW61824672 BCX0">, </span>manipulation of AI modules, exposing sensitive data, data exfiltration and denial of service.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span id="more-21174"></span></p>
<p aria-level="3"><span data-contrast="none">The affected services were:</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></p>
<p style="padding-left: 40px;"><a href="https://aws.amazon.com/cloudformation/" target="_blank" rel="noopener"><span data-contrast="none">CloudFormation</span></a><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559685&quot;:714,&quot;335559739&quot;:0,&quot;335559740&quot;:240,&quot;335559991&quot;:357}"><br />
</span><a href="https://aws.amazon.com/glue/" target="_blank" rel="noopener"><span data-contrast="none">Glue</span></a><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"><br />
</span><a href="https://aws.amazon.com/emr/" target="_blank" rel="noopener"><span data-contrast="none">EMR</span></a><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"><br />
</span><a href="https://aws.amazon.com/sagemaker/" target="_blank" rel="noopener"><span data-contrast="none">SageMaker</span></a><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"><br />
</span><a href="https://aws.amazon.com/servicecatalog/" target="_blank" rel="noopener"><span data-contrast="none">ServiceCatalog</span></a><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"><br />
</span><a href="https://aws.amazon.com/codestar/" target="_blank" rel="noopener"><span data-contrast="none">CodeStar</span></a><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"><span class="TextRun SCXW206876187 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun CommentStart CommentHighlightPipeRestV2 CommentHighlightRest SCXW206876187 BCX0" data-ccp-parastyle="Normal (Web)">These vulnerabilities could have </span><span class="NormalTextRun CommentHighlightRest SCXW206876187 BCX0" data-ccp-parastyle="Normal (Web)">impacted</span><span class="NormalTextRun CommentHighlightRest SCXW206876187 BCX0" data-ccp-parastyle="Normal (Web)"> any organization in the world that has ever used any of these services. In this blog, we thoroughly explain the “Shadow Resource” attack vector, which may lead to resource squatting, and the “Bucket Monopoly” technique that dramatically increases the success rate of an attacker.</span></span><span class="EOP CommentHighlightPipeRestV2 SCXW206876187 BCX0" data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span> </span></p>
<p><span data-contrast="auto">We reported these vulnerabilities to AWS, and they promptly responded and fixed them. </span><span data-contrast="auto">Regarding the possibility that an attacker used this vector previously to exploit the vulnerabilities, AWS indicated that they </span><i><span data-contrast="auto">“are confirming the results of each team’s investigation and will contact customers directly in the event they are affected by any of the reported issues”</span></i><span data-contrast="auto">.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"><span class="TextRun SCXW113166586 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun CommentStart CommentHighlightPipeRestV2 CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">While the vulnerabilities in the above-mentioned services were mitigated by AWS, attacks of this type may still be present in some scenarios or with other services, products, or open-source projects</span><span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">.</span> <span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">AWS u</span><span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">sers </span><span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">are </span><span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">advised to follow</span><span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)"> our</span><span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)"> mitigation</span> <span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">s</span><span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">ection</span> <span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">for best practice measures against such </span><span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">a </span><span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">scenario</span><span class="NormalTextRun CommentHighlightRest SCXW113166586 BCX0" data-ccp-parastyle="Normal (Web)">.</span></span><span class="EOP CommentHighlightPipeRestV2 SCXW113166586 BCX0" data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span> </span></p>
<p><span data-contrast="auto">We appreciate AWS security team’s collaboration on this matter.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p aria-level="3"><span style="text-decoration: underline;"><strong>Timeline: </strong></span></p>
<ul>
<li><b><span data-contrast="auto">16 February 2024:</span></b><span data-contrast="auto"> We reported vulnerabilities in CloudFormation, Glue, EMR, SageMaker, and CodeStar to the AWS security team.</span><span data-ccp-props="{&quot;134233117&quot;:false,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">16 February 2024:</span></b><span data-contrast="auto"> AWS acknowledged and began investigating the issues.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">18 February 2024:</span></b><span data-contrast="auto"> We reported a vulnerability in ServiceCatalog.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">16 March 2024:</span></b><span data-contrast="auto"> AWS confirmed they fixed the vulnerabilities in CloudFormation and EMR.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">25 March 2024:</span></b><span data-contrast="auto"> AWS confirmed they fixed the vulnerabilities in Glue and SageMaker. They also mentioned that CodeStar is considered addressed since new customers are no longer allowed to create projects, as the service is planned for deprecation in July 2024.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">30 April 2024:</span></b><span data-contrast="auto"> We reported that the current fix for CloudFormation leaves users vulnerable to a DoS attack.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">07 May 2024:</span></b><span data-contrast="auto"> AWS indicated they are working on a fix for the CloudFormation issue.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">26 June 2024:</span></b><span data-contrast="auto"> AWS confirmed they fixed the vulnerabilities in ServiceCatalog and CloudFormation.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">August 2024:</span></b><span data-contrast="auto"> This research was presented at Black Hat USA and DEF CON 32.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
</ul>
<p><a name="section-1" class="anchor_offset"></a></p>
<div id="section_wrap_1" class="toc_section_wrap">
<h3 aria-level="1"><span data-contrast="none">Background</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p><span data-contrast="auto">We discovered a new attack vector on AWS, which we named “Shadow Resources”. An example of a shadow resource is an AWS S3 bucket created to support various services. While conducting a thorough investigation of this vector, specifically exploiting S3 buckets resources, we found a technique we named “Bucket Monopoly”. This technique can significantly enhance the success rate of attacks exploiting Shadow S3 bucket resources.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Throughout this blog, we will share insights into our journey of discovering these vulnerabilities. We will explain mitigations, provide guidance on how to check if you have been attacked using these attack vectors, and discuss the fixes that AWS implemented to address these vulnerabilities.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
</div>
<p><a name="section-2" class="anchor_offset"></a></p>
<div id="section_wrap_2" class="toc_section_wrap">
<h3 aria-level="1"><span data-contrast="none">Discovery</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p><span data-contrast="auto">While using AWS CloudFormation, we noticed that when you use this service via the AWS Management Console for the first time in a new region to </span><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacks.html" target="_blank" rel="noopener"><span data-contrast="none">create a new stack</span></a><span data-contrast="auto">, the service automatically triggers AWS to create an S3 bucket for storing our CloudFormation templates.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Initially, we wondered how many users are aware that when they create a new service, such as CloudFormation, a new bucket is created in their account, dedicated to support CloudFormation.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">We also noticed a key aspect about the S3 buckets serving the CloudFormation Service. The name of the bucket is the same across all AWS regions, except the region&#8217;s name (this is explained in detail in the next chapter). </span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">This is the time to remind you a little fact about AWS S3 buckets. The name of a bucket is global across all AWS accounts and is unique, so if you created a bucket named <code>cool-bucket-1</code> you will be the only one in the world owning this bucket, and no one else will be able to create a new bucket bearing this name.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">This led us to wonder: Could someone, possibly an external attacker, somehow guess the name of a CloudFormation S3 bucket and create a new bucket in a different region before the victim?</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Driven by this concern, we delved deeper and discovered that attackers could indeed set up buckets in unused AWS regions and wait for a victim to use the CloudFormation service in a new region, to stealthily use the attacker-controlled S3 buckets as part of the CloudFormation service. </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">We have clearly shown that by doing all the above, attackers can use the S3 buckets planted in their account to execute code, manipulate or steal data, and even gain full control over the victim account without the user’s knowledge. </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Once we discovered this significant vulnerability within the AWS architecture, we expanded our search on other AWS services and found several more. Later we understood that they all share a common attack vector. </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span>
</div>
<p><a name="section-3" class="anchor_offset"></a></p>
<div id="section_wrap_3" class="toc_section_wrap">
<h3><span data-contrast="none">Shadow Resource Attack Vector</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p><span data-contrast="auto">Shadow resources refer to automatically generated assets created by AWS services, often as part of serverless architectures. These resources are typically spawned without explicit instructions from the user and may include various AWS service components. Crucially, the owner of the AWS account may not always be aware of these resources&#8217; existence.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></p>
<h4 aria-level="3"><span data-contrast="none">S3 Buckets as Shadow Resources</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h4>
<p><span data-contrast="auto">An <a href="../../cloud-native-academy/cspm/s3-security/index.html">S3 bucket</a> is an online storage container for managing files, images, videos, and other data, similar to a cloud-based hard drive.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Some AWS services create S3 resources to store necessary operational data, without users always being aware of these S3 resources&#8217; existence.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">For example, in our research, we noticed that </span><a href="https://aws.amazon.com/cloudformation/" target="_blank" rel="noopener"><span data-contrast="none">CloudFormation</span></a><span data-contrast="auto"> (AWS IaC service that automates cloud resource setup using templates) automatically generates an S3 bucket without our explicit direction (&#8220;Shadow Bucket&#8221;). This happens when we upload a template file using CloudFormation on the AWS Management Console, resulting in the automatic creation of a new bucket that follows a specific naming convention. </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<div id="attachment_21428" style="width: 1010px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/0.jpg" class="modal-inline-image"><img fetchpriority="high" decoding="async" aria-describedby="caption-attachment-21428" class="wp-image-21428" src="../../wp-content/uploads/2024/07/0.jpg" alt="The bucket that is created by CloudFormation when uploading a template file" width="1000" height="449" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/0.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/0-300x135.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/0-1024x460.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/0-768x345.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/0-140x63.jpg 140w" sizes="(max-width: 1000px) 100vw, 1000px" /></a><p id="caption-attachment-21428" class="wp-caption-text">The bucket that is created by CloudFormation when uploading a template file</p></div>
<p><span data-contrast="auto">This bucket, created by CloudFormation, has a specific name that consists </span><span data-contrast="auto">of the following parts:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div id="attachment_21178" style="width: 610px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/1.jpg" class="modal-inline-image"><img decoding="async" aria-describedby="caption-attachment-21178" class="wp-image-21178" src="../../wp-content/uploads/2024/07/1.jpg" alt="The structure of the bucket name created by CloudFormation " width="600" height="122" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/1.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/1-300x61.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/1-1024x208.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/1-768x156.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/1-140x28.jpg 140w" sizes="(max-width: 600px) 100vw, 600px" /></a><p id="caption-attachment-21178" class="wp-caption-text">The structure of the bucket name created by CloudFormation</p></div>
<ol>
<li><b><span data-contrast="auto">Prefix: </span></b><span data-contrast="auto">This is the prefix (<code>"cf-templates"</code>) of the S3 bucket created for CloudFormation services when uploading a template via the AWS Management Console. It remains consistent across all AWS accounts.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
<li><b><span data-contrast="auto">Hash</span></b><span data-contrast="auto">: This is a random 12-character hash containing alphanumeric characters (<code>a-z, 0-9</code>).</span></li>
<li><b><span data-contrast="auto">Region</span></b><span data-contrast="auto">: This indicates the name of the region from which the CloudFormation service was utilized</span></li>
</ol>
<p><span class="NormalTextRun SCXW121147417 BCX0">This is the default behavior when using the AWS </span><span class="NormalTextRun SCXW121147417 BCX0">Management Console</span><span class="NormalTextRun SCXW121147417 BCX0">, as it automatically saves the CloudFormation template you have uploaded in this S3 bucket</span></p>
<div id="attachment_21179" style="width: 610px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/2.jpg" class="modal-inline-image"><img decoding="async" aria-describedby="caption-attachment-21179" class="wp-image-21179" src="../../wp-content/uploads/2024/07/2.jpg" alt="Example of a bucket created by CloudFormation in the us-east-1 region " width="600" height="328" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/2.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/2-300x164.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/2-1024x560.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/2-768x420.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/2-140x77.jpg 140w" sizes="(max-width: 600px) 100vw, 600px" /></a><p id="caption-attachment-21179" class="wp-caption-text">Example of a bucket created by CloudFormation in the us-east-1 region</p></div>
<p><span data-contrast="auto">Creating a template in a different region for the same account will generate a CloudFormation bucket name with the same prefix and hash. The only difference will be the region part, which will correspond to the region where the CloudFormation was used.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">For example, if an account uses CloudFormation in the <code>us-east-1</code> region, the associated bucket name is </span><code>cf-templates-123abcdefghi-us-east-1</code><span data-contrast="auto">. When the same account uses CloudFormation in another region, like <code>eu-west-2</code>, AWS creates a new bucket named </span><code>cf-templates-123abcdefghi-eu-west-2</code><span data-contrast="auto">.</span> <span data-contrast="auto">The only difference is the region name.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<div id="attachment_21180" style="width: 1011px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/3.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21180" class="wp-image-21180" src="../../wp-content/uploads/2024/07/3.jpg" alt="If the user uses CloudFormation in a new region, the bucket will be created with the same prefix and hash but with the relevant region " width="1001" height="276" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/3.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/3-300x83.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/3-1024x282.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/3-768x212.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/3-140x39.jpg 140w" sizes="(max-width: 1001px) 100vw, 1001px" /></a><p id="caption-attachment-21180" class="wp-caption-text">If the user uses CloudFormation in a new region, the bucket will be created with the same prefix and hash but with the relevant region</p></div>
<p><span data-contrast="auto">In summary, the CloudFormation bucket name is constructed from three components: the constant service name prefix </span><code>cf-templates</code><span data-contrast="auto">-, a random 12-character string with <span class="ui-provider a b c d e f g h i j k l m n o p q r s t u v w x y z ab ac ae af ag ah ai aj ak" dir="ltr">4,738,381,338,321,616,896</span></span><span data-contrast="auto"> </span><span data-contrast="auto">possible options, which is nearly impossible to guess, and the region name, which is public information (all 33 AWS regions are known). Regarding the hash—can an attacker obtain this information anyway? This is something we will explore later in this blog.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
</div>
<p><a name="section-4" class="anchor_offset"></a></p>
<div id="section_wrap_4" class="toc_section_wrap">
<h3>AWS CloudFormation Vulnerability: “cf-templates-{Hash}-{Region}”</h3>
<p><span data-contrast="auto">At this point, we have two main issues to address:</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<ol>
<li><span data-contrast="auto">What are the implications if another user has already created a bucket with the designated name?</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
<li data-leveltext="%1." data-font="" data-listid="33" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="2" data-aria-level="1"><span data-contrast="auto">Can anyone guess the hash part? Should we treat it as a secret?</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
</ol>
<p><span data-contrast="auto">Before we answer these questions, let&#8217;s briefly describe the workflow when a user creates a new CloudFormation stack using the AWS Management Console.</span></p>
<div id="attachment_21181" style="width: 1011px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/4.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21181" class="wp-image-21181" src="../../wp-content/uploads/2024/07/4.jpg" alt="Overview of Stack Creation on CloudFormation " width="1001" height="471" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/4.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/4-300x141.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/4-1024x482.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/4-768x362.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/4-140x66.jpg 140w" sizes="(max-width: 1001px) 100vw, 1001px" /></a><p id="caption-attachment-21181" class="wp-caption-text">Overview of Stack Creation on CloudFormation</p></div>
<h4>C<span class="TextRun SCXW116866668 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="none"><span class="NormalTextRun SCXW116866668 BCX0" data-ccp-parastyle="heading 3">loudFormation </span><span class="NormalTextRun SCXW116866668 BCX0" data-ccp-parastyle="heading 3">N</span><span class="NormalTextRun SCXW116866668 BCX0" data-ccp-parastyle="heading 3">ew </span><span class="NormalTextRun SCXW116866668 BCX0" data-ccp-parastyle="heading 3">Stack</span><span class="NormalTextRun SCXW116866668 BCX0" data-ccp-parastyle="heading 3"> Workflow</span></span><span class="EOP SCXW116866668 BCX0" data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h4>
<ol>
<li><span data-contrast="auto">The user selects </span><b><span data-contrast="auto">Upload a template file</span></b><span data-contrast="auto"> to initiate the creation of a CloudFormation stack, which invokes the </span><code>CreateUploadBucket</code><span data-contrast="auto"> API request. This process creates the bucket using </span><b><span data-contrast="auto">CreateBucket </span></b><span data-contrast="auto">API request.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559685&quot;:360,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
<li data-leveltext="%1." data-font="" data-listid="11" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:1440,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="2" data-aria-level="1"><span data-contrast="auto">CloudFormation automatically creates an S3 bucket if one doesn’t already exist for the user, following the pattern: </span><code>cf-templates-{Hash}-{Region}</code><span data-contrast="auto">. If the bucket already exists, CloudFormation will use it.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559685&quot;:360,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
<ul>
<li data-leveltext="%1." data-font="" data-listid="11" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:1440,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="2" data-aria-level="1"><span data-contrast="auto">The </span><b><span data-contrast="auto">Hash</span></b><span data-contrast="auto"> is unique to each account and remains the same across different regions</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
<li data-leveltext="%1." data-font="" data-listid="11" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:1440,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="2" data-aria-level="1"><span data-contrast="auto">The </span><b><span data-contrast="auto">Region</span></b><span data-contrast="auto"> in the bucket name corresponds to where the CloudFormation service was initiated.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
</ul>
</li>
<li data-leveltext="%1." data-font="" data-listid="11" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:1440,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="2" data-aria-level="1"><span data-contrast="auto">The server returns the S3 bucket name.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559685&quot;:360,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
<li data-leveltext="%1." data-font="" data-listid="11" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:1440,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="2" data-aria-level="1"><span data-contrast="auto">The user invokes </span><code>PutObject </code><span data-contrast="auto">API request to store the template file in the S3 bucket.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559685&quot;:360,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
<li data-leveltext="%1." data-font="" data-listid="11" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:1440,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="2" data-aria-level="1"><span data-contrast="auto">Actions for validation and more will be performed in the background (for example, </span><code>GetTemplateSummary</code><span data-contrast="auto"> and </span><code>DescribeStacks</code><span data-contrast="auto">).</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559685&quot;:360,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
<li data-leveltext="%1." data-font="" data-listid="11" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:1440,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="2" data-aria-level="1"><span data-contrast="auto">The user will complete the details of the stack and initiate the </span><code>CreateStack</code><span data-contrast="auto"> API request.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559685&quot;:360,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
</ol>
</div>
<p><a name="section-5" class="anchor_offset"></a></p>
<div id="section_wrap_5" class="toc_section_wrap">
<h3 aria-level="3"><span data-contrast="none">What If&#8230; the CloudFormation Bucket Is Already Taken by an Attacker? </span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p><span data-contrast="auto">To explore the vulnerability in CloudFormation, we will use two AWS accounts &#8211; one as the victim and the other as the attacker:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<ol>
<li data-leveltext="%1." data-font="" data-listid="9" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;multilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><b><span data-contrast="auto">Account A (Victim): </span></b><span data-contrast="auto">Simulates typical user behavior by deploying a new stack via CloudFormation in the AWS Management Console.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li data-leveltext="%1." data-font="" data-listid="9" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;multilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><b><span data-contrast="auto">Account B (Attacker): </span></b><span data-contrast="auto">Attempts to claim resources that </span><i><span data-contrast="auto">Account A</span></i><span data-contrast="auto"> would request, knowing </span><i><span data-contrast="auto">Account A&#8217;s</span></i><span data-contrast="auto"> CloudFormation hash.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
</ol>
<p><span data-contrast="auto">Let&#8217;s assume that the attacker knows the CloudFormation hash part of a specific/targeted account on AWS. (As noted later, direct knowledge of the hash is essential. We have not found a way to calculate it from an account ID or any other account metadata, but we still find instances where users expose this hash, such as in open-source projects, etc.).</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">As mentioned during our research</span><b><span data-contrast="auto">, </span></b><span data-contrast="auto">this hash is unique per account and</span><b><span data-contrast="auto"> will be the same across all regions.</span></b><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">The victim has a stack in </span><code>us-east-1</code><span data-contrast="auto">, so the attacker can create a bucket with the predictable name in </span><code>eu-west-2</code><span data-contrast="auto"> or another region that the victim hasn’t used yet. <span class="TextRun SCXW154737736 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)">When the attacker </span><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)">attempts</span><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)"> to claim the resource</span><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)"> t</span><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)">hat Account A would </span><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)">request</span><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)">, it </span><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)">actually performs</span><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)"> “Resource Squatting” or, more specifically, “</span><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)">S3 Bucket </span><span class="NormalTextRun SpellingErrorV2Themed SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)">Namesquatting</span><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)">” <span class="NormalTextRun ContextualSpellingAndGrammarErrorV2Themed CommentHighlightRest SCXW104790039 BCX0" data-ccp-parastyle="Normal (Web)">or </span><span class="NormalTextRun ContextualSpellingAndGrammarErrorV2Themed CommentHighlightRest SCXW104790039 BCX0" data-ccp-parastyle="Normal (Web)">”</span><span class="NormalTextRun ContextualSpellingAndGrammarErrorV2Themed CommentHighlightRest SCXW104790039 BCX0" data-ccp-parastyle="Normal (Web)">Bucket</span> <span class="NormalTextRun CommentHighlightRest SCXW104790039 BCX0" data-ccp-parastyle="Normal (Web)">S</span><span class="NormalTextRun CommentHighlightRest SCXW104790039 BCX0" data-ccp-parastyle="Normal (Web)">niping</span><span class="NormalTextRun CommentHighlightRest SCXW104790039 BCX0" data-ccp-parastyle="Normal (Web)">” </span>in this case. This idea has come up in the past, and you can read a great </span></span><a class="Hyperlink SCXW154737736 BCX0" href="https://onecloudplease.com/blog/s3-bucket-namesquatting" target="_blank" rel="noreferrer noopener"><span class="TextRun Underlined SCXW154737736 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="none"><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-charstyle="Hyperlink">blog</span></span></a><span class="TextRun SCXW154737736 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)"> by </span></span><a class="Hyperlink SCXW154737736 BCX0" href="https://twitter.com/iann0036" target="_blank" rel="noreferrer noopener"><span class="TextRun Underlined SCXW154737736 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="none"><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-charstyle="Hyperlink">Ian </span><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-charstyle="Hyperlink">Mckay</span></span></a><span class="TextRun SCXW154737736 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)"> about a similar concept</span></span><span class="TextRun SCXW154737736 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun SCXW154737736 BCX0" data-ccp-parastyle="Normal (Web)">. </span></span><span class="EOP SCXW154737736 BCX0" data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></span></p>
<p><span data-contrast="auto">The following sequence of events will occur when the victim tries to deploy a new CloudFormation stack in </span><code>eu-west-2</code> <span data-contrast="auto">for the first time:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<ol>
<li data-leveltext="%1." data-font="" data-listid="14" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;multilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><strong>Victim Initiates Action</strong><span data-contrast="auto"><strong>:</strong> The victim, operating in </span><i><span data-contrast="auto">Account A</span></i><span data-contrast="auto">, starts the process by uploading a CloudFormation template via the AWS Management Console. This CloudFormation service will check if an S3 bucket with the name </span><code>cf-templates-{Hash}-{Region}</code><span data-contrast="auto"> exists. If not, it will attempt to create one.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
<li data-leveltext="%1." data-font="" data-listid="14" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;multilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><strong>Bucket Already Claimed by Attacker:</strong><span data-contrast="auto"> The victim is completely unaware that the attacker created the bucket in </span><i><span data-contrast="auto">Account B</span></i><span data-contrast="auto">. </span><b><span data-contrast="auto">Since S3 bucket names are globally unique across all AWS accounts, the intended bucket name is already taken.</span></b><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
<li data-leveltext="%1." data-font="" data-listid="14" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;multilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><strong><span style="font-size: 16px;" data-contrast="auto">CloudFormation Error:</span></strong><span style="font-size: 16px;" data-contrast="auto"> <span class="NormalTextRun CommentStart CommentHighlightPipeClickedV2 CommentHighlightClicked SCXW163527985 BCX0">When the CloudFormation service in Account A tries to create the S3 bucket and upload the template file to it, the service </span><span class="NormalTextRun CommentHighlightClicked SCXW163527985 BCX0">encounters</span><span class="NormalTextRun CommentHighlightClicked SCXW163527985 BCX0"> an issue. Although the service recognizes that the bucket exists, the process fails, and CloudFormation returns an </span><span class="NormalTextRun CommentHighlightClicked SCXW163527985 BCX0">error, typically an &#8220;</span><span class="NormalTextRun SpellingErrorV2Themed CommentHighlightClicked SCXW163527985 BCX0">AccessDenied</span><span class="NormalTextRun CommentHighlightClicked SCXW163527985 BCX0">&#8221; indicating that the service </span><span class="NormalTextRun CommentHighlightClicked SCXW163527985 BCX0">failed to</span><span class="NormalTextRun CommentHighlightClicked SCXW163527985 BCX0"> upload the template file to the existing S3 bucket</span><span class="NormalTextRun CommentHighlightClicked SCXW163527985 BCX0">.</span> </span></li>
</ol>
<div id="attachment_21183" style="width: 1010px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/5.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21183" class="wp-image-21183" src="../../wp-content/uploads/2024/07/5.jpg" alt="When an attacker claims the predictable bucket name of another AWS account's CloudFormation service, the victim's CloudFormation service will try to access and use the attacker's bucket " width="1000" height="501" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/5.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/5-300x150.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/5-1024x513.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/5-768x385.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/5-140x70.jpg 140w" sizes="(max-width: 1000px) 100vw, 1000px" /></a><p id="caption-attachment-21183" class="wp-caption-text">When an attacker claims the predictable bucket name of another AWS account&#8217;s CloudFormation service, the victim&#8217;s CloudFormation service will try to access and use the attacker&#8217;s bucket</p></div>
<p><span data-contrast="auto">In summary, by knowing the hash of a CloudFormation template of other AWS users and claiming their bucket in a specific region, an attacker can prevent them from using the &#8220;upload a template file&#8221; feature on CloudFormation. </span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div id="attachment_21182" style="width: 1010px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/4.5.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21182" class="wp-image-21182" src="../../wp-content/uploads/2024/07/4.5.jpg" alt="The victim is blocked from using the CloudFormation service because the attacker has claimed the S3 bucket " width="1000" height="494" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/4.5.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/4.5-300x148.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/4.5-1024x505.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/4.5-768x379.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/4.5-140x69.jpg 140w" sizes="(max-width: 1000px) 100vw, 1000px" /></a><p id="caption-attachment-21182" class="wp-caption-text">The victim is blocked from using the CloudFormation service because the attacker has claimed the S3 bucket</p></div>
<p><span data-contrast="auto">This can be considered a Denial of Service (DoS) attack. This occurred because the S3 bucket is set by default to <code>block all public access</code>, and the S3 bucket does not have a resource-based policy, so the victim role did not have permission to perform actions on the attacker’s bucket. So, we wondered what would happen if we changed that. Let&#8217;s escalate it!</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
</div>
<p><a name="section-6" class="anchor_offset"></a></p>
<div id="section_wrap_6" class="toc_section_wrap">
<h3 aria-level="3"><span data-contrast="none">What if… the Attacker Opens the Bucket for Public Access and Creates a Permissive Policy?</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p><span data-contrast="auto">To escalate the attack from DoS to a more severe impact, the attacker could change the configuration of the predictable S3 bucket to be publicly accessible.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">This would allow the CloudFormation service of the victim to access it.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<div id="attachment_21185" style="width: 1010px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/6.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21185" class="wp-image-21185" src="../../wp-content/uploads/2024/07/6.jpg" alt="To escalate the attack, an attacker needs to allow public access to the predictable S3 bucket" width="1000" height="406" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/6.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/6-300x122.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/6-1024x415.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/6-768x312.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/6-140x57.jpg 140w" sizes="(max-width: 1000px) 100vw, 1000px" /></a><p id="caption-attachment-21185" class="wp-caption-text">To escalate the attack, an attacker needs to allow public access to the predictable S3 bucket</p></div>
<p><span data-contrast="auto">But that is not enough. To enable </span><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_evaluation-logic-cross-account.html" target="_blank" rel="noopener"><span data-contrast="none">cross-account policy evaluation logic</span></a><span data-contrast="auto">, an attacker would need to create a permissive resource-based policy on their </span><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/example-bucket-policies.html" target="_blank" rel="noopener"><span data-contrast="none">S3 bucket</span></a><span data-contrast="auto">. This policy should explicitly grant permissions to another IAM principal (specifically the vulnerable AWS service). It should allow operations such as </span><a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutObject.html" target="_blank" rel="noopener"><span data-contrast="none">s3:Pu</span><span data-contrast="none">tObject</span></a><span data-contrast="auto"> ,</span><a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_GetObject.html" target="_blank" rel="noopener"><span data-contrast="none">s3:GetObject</span></a><span data-contrast="auto"> , </span><a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListBuckets.html" target="_blank" rel="noopener"><span data-contrast="none">s3:ListBucket</span></a><span data-contrast="auto">, etc. This way, the victim’s vulnerable service will be able to read and write data to the attacker-controlled bucket.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">In the following example, we wrote a highly permissive policy that enables the victim&#8217;s service to access and take any action on the attacker&#8217;s bucket. However, the policy doesn’t need to be so permissive. Mind that, if you wish to replicate our steps or to use this in PT or Red Team assessments, you should tailor the policy, to only fit the actions that the vulnerable service needs.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><script src="../../../gist.github.com/yakirk/d10cbb9e754be53b8a71c5d688a8a3dd.js"></script></p>
<p><span data-contrast="auto">After the attacker claims the predictable bucket, makes it publicly accessible, and defines a bucket policy that allows other principals to read and write data to and from it, an interesting thing happens. </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">The CloudFormation service in </span><i><span data-contrast="auto">Account A</span></i><span data-contrast="auto"> tries to create the S3 bucket and upload the template file to it, but since the bucket already exists (in the attacker’s account), it will trust it, access it, and drop its template file to it.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><b><span data-contrast="auto">This results in an information disclosure vulnerability</span></b><span data-contrast="auto"> on CloudFormation, as the attacker can now read the files that the victim&#8217;s CloudFormation service writes to the malicious S3 bucket.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Given that CloudFormation templates have the potential to contain sensitive information such as environment variables, credentials, and more, if users don’t follow best </span><a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/security-best-practices.html#creds" target="_blank" rel="noopener"><span data-contrast="none">practices</span></a><span data-contrast="auto"> this vulnerability could lead to a critical impact on the organization. Attackers could exploit the information exposed in the templates they deploy.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span>
</div>
<p><a name="section-7" class="anchor_offset"></a></p>
<div id="section_wrap_7" class="toc_section_wrap">
<h3 aria-level="3"><span data-contrast="none">What if… the Attacker Modifies the Template Files? </span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p><span data-contrast="auto">To elevate this vulnerability to the highest level of severity, we will utilize it with another technique called </span><a href="https://rhinosecuritylabs.com/aws/cloud-malware-cloudformation-injection/" target="_blank" rel="noopener"><span data-contrast="none">Resource Injection in CloudFormation Templates</span></a><span data-contrast="auto">, published by RhinoLab (also credits Matt Fuller, <a href="https://x.com/matthewdfuller" target="_blank" rel="noopener">@matthewdfuller</a>). </span><span data-ccp-props="{&quot;134233117&quot;:false,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">In essence, this technique leverages a Time of Check to Time of Use (TOCTOU) issue at CloudFormation, that allows an attacker a window of opportunity to modify CloudFormation templates before they are executed.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">This time, the technique will be on steroids, because many of the original conditions and prerequisites are no longer necessary for our attack vector to succeed.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">To underscore the gravity of this vulnerability, we follow the behavior of the </span><a href="https://github.com/RhinoSecurityLabs/pacu/wiki/Module-Details#cfn__resource_injection" target="_blank" rel="noopener"><span data-contrast="none">Pacu module</span></a><span data-contrast="auto"> of this technique (Pacu is an open-source AWS exploitation framework, designed to test the security of AWS environments).</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">Before we dive into the attack workflow, the attacker needs to complete the following steps:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<ol>
<li data-leveltext="%1." data-font="Calibri" data-listid="20" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><span data-contrast="auto">Claim the bucket with the predictable name of the victim. Allow public access and define a permissive resource-based policy for the bucket as shown previously.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li data-leveltext="%1." data-font="Calibri" data-listid="20" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><span data-contrast="auto">Create a Lambda function that will inject a resource or backdoor into a given template file. This Lambda function must be set to trigger by the </span><a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketNotification.html" target="_blank" rel="noopener"><span data-contrast="none">PutBucketNotification</span></a><span data-contrast="auto"> event on the attacker&#8217;s bucket. So, whenever a file is dropped into this bucket, the Lambda function will modify it.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
</ol>
<div id="attachment_21373" style="width: 1410px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/8.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21373" class="wp-image-21373 size-full" src="../../wp-content/uploads/2024/07/8.jpg" alt="Overview of CloudFormation vulnerability" width="1400" height="397" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/8.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/8-300x85.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/8-1024x290.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/8-768x218.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/8-140x40.jpg 140w" sizes="(max-width: 1400px) 100vw, 1400px" /></a><p id="caption-attachment-21373" class="wp-caption-text">Overview of CloudFormation vulnerability</p></div>
<p>N<span class="TextRun SCXW181387037 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun SCXW181387037 BCX0" data-ccp-parastyle="Normal (Web)">ow we can describe the attack and how we can achieve admin role access on a targeted victim&#8217;s account:</span></span><span class="EOP SCXW181387037 BCX0" data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<ol>
<li data-leveltext="%1." data-font="Calibri" data-listid="19" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><span data-contrast="auto">A victim uses CloudFormation via the AWS Management Console and clicks </span><b><span data-contrast="auto">Create stack</span></b><span data-contrast="auto">. Then, the user chooses </span><b><span data-contrast="auto">Choose an existing template</span></b><span data-contrast="auto"> and selects a template file from their workstation by using <code>Upload a template file </code>option.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><span data-contrast="auto">Since the attacker has already claimed the bucket name used by the victim’s CloudFormation service, the user&#8217;s template file is written to the attacker&#8217;s S3 bucket.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><span data-contrast="auto">The Lambda function is triggered by the S3 </span><code>PutBucketNotification</code><span data-contrast="auto">, indicating that a new file was dropped in the attacker&#8217;s bucket.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><span data-contrast="auto">The Lambda function reads the victim&#8217;s template file.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><span data-contrast="auto">The Lambda function modifies the victim&#8217;s template file and injects a new admin role that can be assumed by the attacker.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><span data-contrast="auto">The Lambda function pushes the new backdoored template file.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><span data-contrast="auto">Meanwhile, the user has not yet finished deploying the new CloudFormation stack. They still need to progress through manual steps such as choosing the stack name, approving capabilities, and more. Once the user completes these steps, they will click </span><b><span data-contrast="auto">Submit</span></b><span data-contrast="auto"> to finish the creation. This is what creates the TOCTOU-like (Time-of-Check to Time-of-Use) issue, allowing the template to be tampered with.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><span data-contrast="auto">The victim’s CloudFormation service gets the malicious template file from the attacker’s bucket.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><span data-contrast="auto">The victim&#8217;s CloudFormation service will deploy the backdoored template file, creating a new admin role that can be assumed by the attacker. The attacker only needs to search their logs for the victim&#8217;s account ID and then assume the injected admin role.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
</ol>
<p><span data-contrast="auto">Here is a Proof of Concept (PoC) video demonstrating the vulnerability:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div style="width: 640px;" class="wp-video"><!--[if lt IE 9]><script>document.createElement('video');</script><![endif]-->
<video class="wp-video-shortcode" id="video-21174-1" width="640" height="360" preload="metadata" controls="controls"><source type="video/mp4" src="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/CloudFormation.mp4?_=1" /><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/CloudFormation.mp4">https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/CloudFormation.mp4</a></video></div>
<p><span class="TextRun SCXW148363950 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun CommentStart CommentHighlightPipeRestV2 CommentHighlightRest SCXW148363950 BCX0">Essentially, </span></span><strong><span class="TextRun MacChromeBold SCXW148363950 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun CommentHighlightRest SCXW148363950 BCX0">we</span><span class="NormalTextRun CommentHighlightRest SCXW148363950 BCX0"> may be able to create an admin role in a target organization</span></span></strong><span class="TextRun SCXW148363950 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun CommentHighlightRest SCXW148363950 BCX0"> (depending on the privileges of the user invoking CloudFormation) simply by knowing their CloudFormation unique hash. Under those circumstances, if we somehow find that hash and the initiator of CloudFormation has sufficient privileges, this results in the most severe outcome we can achieve in the cloud, as it allows us to take over the victim&#8217;s account.</span></span><span class="EOP CommentHighlightPipeRestV2 SCXW148363950 BCX0" data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span style="text-decoration: underline;">A couple of disclaimers:</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:0,&quot;335559740&quot;:240}"> </span></p>
<ol>
<li data-leveltext="%1." data-font="" data-listid="24" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><span data-contrast="auto"><span class="NormalTextRun CommentStart CommentHighlightPipeRestV2 CommentHighlightRest SCXW43816003 BCX0">As </span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">noted above, t</span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">o</span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0"> create </span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">an </span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">admin role (</span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">backdoor</span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">)</span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0"> in the victim account</span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">, </span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">whoever </span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">initiated</span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0"> the CloudFormation service</span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0"> needs to have </span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">permissions to </span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">manage IAM roles</span><span class="NormalTextRun CommentHighlightRest SCXW43816003 BCX0">. </span> This depends on what privileges the user who had launched the stack has or the IAM service role defined during the stack creation.</span> Mind that even if these privileges are limited to specific resources, attackers can still modify resources according to the permissions of user/role on the victim’s account. For example, modify Lambda functions, alter EC2 instances, change container images to malicious ones, or change the policy of a newly deployed S3 bucket, depending on the use case.  It&#8217;s important to remember that users who can use the AWS Management Console and deploy stacks typically have high-level permissions. <span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559685&quot;:720,&quot;335559739&quot;:0,&quot;335559740&quot;:240}"> </span></li>
<li data-leveltext="%1." data-font="" data-listid="24" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><span data-contrast="auto">The attacker needs to wait for the victim to deploy a new CloudFormation stack in a new region for the first time to successfully launch the attack. While this process can take some time, you need to consider that in big organizations with hundreds of accounts and thousands of users the probability of occurrence is high.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:0,&quot;335559740&quot;:240}"> </span></li>
</ol>
<p aria-level="2"><span data-contrast="auto">To sum up all the above, we discovered a way to inject resources and potentially even an admin role into another AWS account! But let&#8217;s discuss the big elephant in the room, the attacker still needs to discover the unique hash in the CloudFormation S3 bucket name associated with the victim&#8217;s account, now let’s talk about this issue.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
</div>
<p><a name="section-8" class="anchor_offset"></a></p>
<div id="section_wrap_8" class="toc_section_wrap">
<h3 aria-level="3"><span data-contrast="none">CloudFormation S3 Bucket Hash</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p><span data-contrast="auto">As mentioned, the S3 bucket name used by the CloudFormation service through the AWS console includes a format: </span><code>cf-templates-{Hash}-{Region}</code><span data-contrast="auto">. This hash is unique to each account and remains consistent across different regions. It consists of an alphanumeric sequence of 12-characters (a-z, 0-9), resulting in 4,738,381,338,321,616,896 possible combinations, making it impossible to simply guess or brute force.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">In our research, we have attempted to discover methods to predict or calculate this hash, potentially based on another unique identifier, so we can deduce it for each account. Our findings show that this hash is the same for each account in all regions, suggesting it could be based on the account ID or a similar unique identifier.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p>However, we have not been able to determine a way to calculate the hash directly from the account ID or any other account-related metadata. It seems to be a random value, which is good in terms of security.</p>
<p><strong>Nevertheless, we have identified numerous hashes used by different AWS accounts simply by utilizing GitHub regex searches/Sourcegraph, scrape open issues, etc. </strong></p>
<p><span data-contrast="auto">Essentially, this vector could still be very dangerous to organizations that share or expose this hash.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
</div>
<p><a name="section-9" class="anchor_offset"></a></p>
<div id="section_wrap_9" class="toc_section_wrap">
<h3 aria-level="1"><span data-contrast="none">Exploring More Vulnerabilities</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p><span data-contrast="auto">During our investigation into exposed CloudFormation hashes on GitHub, we discovered a variety of S3 bucket patterns. This revealed that these attack vectors are more widespread than we initially thought and could potentially cause greater damage to other services that create and use shadow resources as part of their operation.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">In simpler terms, some AWS services create S3 buckets using predictable names. Instead of using a hash, they often use the </span><b><span data-contrast="auto">AWS account ID</span></b><span data-contrast="auto"> as the unique identifier for these buckets. For example, a bucket name used by one of the AWS services might follow this pattern: </span><code>{Service Prefix}-{AWS Account ID}-{Region}</code>.</p>
<p><span data-contrast="auto">To hunt for potentially vulnerable services creating shadow resources, we used the following approach:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<ol>
<li><b><span data-contrast="auto">AWS Documentation Review:</span></b><span data-contrast="auto"> We searched AWS documentation to find potential documents detailing S3 bucket patterns created by various services.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">Crawling AWS Services:</span></b><span data-contrast="auto"> We crawled over AWS services, monitoring the creation of S3 buckets or other resources during their operation. </span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">Automate the Crawling on AWS services:</span></b><span data-contrast="auto"> We developed an open-source tool called TrailShark, which alerts us to the creation of new S3 buckets or any other resources generated by API calls in our AWS account. This tool integrates AWS CloudTrail logs directly into Wireshark, enabling near-real-time analysis of AWS API calls. In our use case, it helps identify new resources created during our crawling process. </span><span data-contrast="none">More information about the tool is available in this <a href="../trailshark-understanding-aws-api-and-service-interactions/index.html" target="_blank" rel="noopener">blog</a>.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">GitHub Regex Search:</span></b><span data-contrast="auto"> We utilized GitHub&#8217;s regex search feature and wrote regex patterns to find S3 bucket names that include a prefix, some identifier, and a region. For example, we searched for patterns like </span><code>/s3\.amazonaws\.com\/[a-zA-Z0-9-]*-.*-(west|east)-(1|2)/</code><span data-contrast="auto"> or variations of </span><code>arn:aws:s3</code> <span data-contrast="auto">containing an identifier and region.</span></li>
</ol>
<p><span class="TextRun SCXW234965805 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun SCXW234965805 BCX0">We discovered several potential S3 buckets used by AWS services that are predictable</span></span></p>
<div id="attachment_21218" style="width: 610px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/9.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21218" class="wp-image-21218" src="../../wp-content/uploads/2024/07/9.jpg" alt="An example of an S3 bucket name that we found, and suspect is vulnerable to this attack vector " width="600" height="700" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/9.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/9-257x300.jpg 257w, https://www.aquasec.com/wp-content/uploads/2024/07/9-878x1024.jpg 878w, https://www.aquasec.com/wp-content/uploads/2024/07/9-768x896.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/9-1317x1536.jpg 1317w, https://www.aquasec.com/wp-content/uploads/2024/07/9-120x140.jpg 120w" sizes="(max-width: 600px) 100vw, 600px" /></a><p id="caption-attachment-21218" class="wp-caption-text">An example of an S3 bucket name that we found, and suspect is vulnerable to this attack vector</p></div>
<p aria-level="3"><span data-contrast="auto">After verifying and exploiting them, we identified several vulnerable AWS services.</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">We reviewed a few dozens of AWS services and found a total of 6 vulnerable AWS services, below we describe the vulnerabilities and our research process:</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
</div>
<p><a name="section-10" class="anchor_offset"></a></p>
<div id="section_wrap_10" class="toc_section_wrap">
<h3>AWS Glue Vulnerability: “aws-glue-assets-{Account-ID}-{Region}”</h3>
<p><span data-contrast="auto">AWS Glue is a service that is utilized by data engineers and analysts to automate the extraction, transformation, and loading (ETL) processes, streamlining data preparation for analytics and machine learning.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">In our research, we found that when a user creates a job using the AWS Management Console with the Visual ETL tool, an S3 bucket is used to store Glue jobs, which are primarily Python scripts executed by Glue.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">This S3 bucket is created automatically for the user by the Glue Service, according to this pattern: </span><code>aws-glue-assets-{Account-ID}-{Region}</code><span data-contrast="auto">.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div id="attachment_21189" style="width: 1011px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/10.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21189" class="wp-image-21189" src="../../wp-content/uploads/2024/07/10.jpg" alt="The S3 bucket created by the Glue service " width="1001" height="434" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/10.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/10-300x130.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/10-1024x444.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/10-768x333.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/10-140x61.jpg 140w" sizes="(max-width: 1001px) 100vw, 1001px" /></a><p id="caption-attachment-21189" class="wp-caption-text">The S3 bucket created by the Glue service</p></div>
<p><span data-contrast="auto">Since this bucket has a constant prefix, followed by the account ID and the region of the Glue service, its name is predictable. An attacker who knows your AWS account ID could potentially create this bucket in any region if it doesn&#8217;t already exist, and then wait for the victim to use Glue ETL via the AWS Management Console for the first time in a new region. This will lead to the victim&#8217;s Glue service writing files to the attacker-controlled bucket.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">The attack scenario and general concept are similar to the CloudFormation vulnerability.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:0,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">The following pre-steps will be required for almost any future vulnerability we examine:</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:0,&quot;335559740&quot;:240}"> </span></p>
<ol>
<li><span data-contrast="auto">An attacker would need to claim the predictable S3 bucket of the victim that will be used by the vulnerable service.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><span data-contrast="auto">Define a permissive resource-based and allow public access to the bucket.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><span data-contrast="auto">Define a Lambda function that will be triggered by a </span><code>PutBucketNotification</code><span data-contrast="auto"> and will perform a malicious action.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
</ol>
<div id="attachment_21186" style="width: 1011px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/11.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21186" class="wp-image-21186" src="../../wp-content/uploads/2024/07/11.jpg" alt="Overview of Glue vulnerability " width="1001" height="404" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/11.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/11-300x121.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/11-1024x413.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/11-768x310.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/11-140x57.jpg 140w" sizes="(max-width: 1001px) 100vw, 1001px" /></a><p id="caption-attachment-21186" class="wp-caption-text">Overview of Glue vulnerability</p></div>
<p><span data-contrast="auto">In this case, the Lambda function will inject code into any file that is dropped into the bucket.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span><span data-contrast="auto">In fact, this vulnerability allows an attacker to inject any code into the Glue job of the victim, resulting in remote code execution (<a href="../../cloud-native-academy/cloud-attacks/remote-code-execution/index.html">RCE</a>). In some scenarios, it is also possible to create other resources in the victim’s account or an admin role that could be assumed by the attacker, depending on the role granted to the Glue job by the victim.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span class="TextRun SCXW15937756 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun CommentStart CommentHighlightPipeClickedV2 CommentHighlightClicked SCXW15937756 BCX0" data-ccp-parastyle="Normal (Web)">Most of the time, </span><span class="NormalTextRun CommentHighlightClicked SCXW15937756 BCX0" data-ccp-parastyle="Normal (Web)">the</span> </span><a class="Hyperlink SCXW15937756 BCX0" href="https://docs.aws.amazon.com/glue/latest/dg/set-up-iam.html" target="_blank" rel="noreferrer noopener"><span class="TextRun Underlined SCXW15937756 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="none"><span class="NormalTextRun CommentHighlightClicked SCXW15937756 BCX0" data-ccp-charstyle="Hyperlink">default AWS Glue service role</span></span></a><span class="TextRun SCXW15937756 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun CommentHighlightClicked SCXW15937756 BCX0" data-ccp-parastyle="Normal (Web)"> will be used. This role is created when the user chooses the standard AWS Glue service role, which is the default option. AWS Glue then creates a new IAM role in their AWS account named </span></span><a class="Hyperlink SCXW15937756 BCX0" href="https://docs.aws.amazon.com/aws-managed-policy/latest/reference/AWSGlueServiceRole.html" target="_blank" rel="noreferrer noopener"><span class="TextRun Underlined SCXW15937756 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="none"><span class="NormalTextRun CommentHighlightClicked SCXW15937756 BCX0" data-ccp-charstyle="Hyperlink">AWSGlueServiceRole</span></span></a><span class="TextRun SCXW15937756 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun CommentHighlightClicked SCXW15937756 BCX0" data-ccp-parastyle="Normal (Web)">. This role will have </span></span><span class="TextRun Underlined SCXW15937756 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="none"><span class="NormalTextRun CommentHighlightClicked SCXW15937756 BCX0" data-ccp-charstyle="Hyperlink">policies</span></span><span class="TextRun SCXW15937756 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"> <span class="NormalTextRun CommentHighlightClicked SCXW15937756 BCX0" data-ccp-parastyle="Normal (Web)">allowing</span><span class="NormalTextRun CommentHighlightClicked SCXW15937756 BCX0" data-ccp-parastyle="Normal (Web)"> the creation, modification, and deletion of AWS Glue jobs. Furthermore, this role can be exploited for malicious purposes, such as gathering information about IAM roles, potentially escalating privileges, and accessing and manipulating S3 buckets and objects.</span></span></p>
<p><span data-contrast="auto">Mind that the user can choose other roles, and in that case, if the role grants excessive permissions to their Glue job, it can lead to a complete compromise of the account by an attacker. Therefore, it is crucial to adhere to the principle of least privilege and only grant the necessary permissions to services, jobs, and other resources.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">Another interesting behavior we noticed is that even after the attacker modified the content of the Glue scripts and it’s now malicious, when the victim tries to view it in the AWS Management Console, the old content is displayed instead of the modified one. This means that in the GUI the malicious script is hidden from the users, even though the victim’s Glue service will run the modified/malicious one. This occurs due to a caching mechanism. However, if the victim tries to edit the script, they will be exposed to the backdoor version.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">Here is a Proof of Concept (PoC) video demonstrating the vulnerability:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div style="width: 640px;" class="wp-video"><video class="wp-video-shortcode" id="video-21174-2" width="640" height="360" preload="metadata" controls="controls"><source type="video/mp4" src="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Glue.mp4?_=2" /><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Glue.mp4">https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Glue.mp4</a></video></div></div>
<p><a name="section-11" class="anchor_offset"></a></p>
<div id="section_wrap_11" class="toc_section_wrap">
<h3>AWS EMR Vulnerability: “aws-emr-studio-{Account-ID}-{Region}”</h3>
<p><span data-contrast="auto">AWS EMR (Elastic MapReduce) is a service used by data practitioners and developers to process and analyze large datasets using popular big data frameworks such as Apache Hadoop, Apache Spark, Apache Hive, and others, facilitating scalable and cost-effective data processing and analysis.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">In our research, we found that when a user utilizes the EMR service and the “EMR Studio” to create a studio, the EMR service automatically generates an S3 bucket. This S3 bucket follows the naming pattern: </span><code>aws-emr-studio-{Account-ID}-{Region}</code></p>
<div id="attachment_21190" style="width: 810px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/12.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21190" class="wp-image-21190" src="../../wp-content/uploads/2024/07/12.jpg" alt="The S3 bucket created by the EMR service " width="800" height="415" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/12.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/12-300x156.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/12-1024x532.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/12-768x399.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/12-140x73.jpg 140w" sizes="(max-width: 800px) 100vw, 800px" /></a><p id="caption-attachment-21190" class="wp-caption-text">The S3 bucket created by the EMR service</p></div>
<p><span data-contrast="auto">Since we already know that this bucket name is predictable and contains a constant prefix, followed by the account ID and the region of the EMR service, an attacker can target organizations by using their AWS account ID. They can create an unclaimed bucket with this predictable name and wait for the victim to deploy a new EMR Studio in a new region.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div id="attachment_21376" style="width: 1410px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/13-1.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21376" class="wp-image-21376 size-full" src="../../wp-content/uploads/2024/07/13-1.jpg" alt="Overview of EMR vulnerability" width="1400" height="400" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/13-1.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/13-1-300x86.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/13-1-1024x293.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/13-1-768x219.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/13-1-140x40.jpg 140w" sizes="(max-width: 1400px) 100vw, 1400px" /></a><p id="caption-attachment-21376" class="wp-caption-text">Overview of EMR vulnerability</p></div>
<p><span style="text-decoration: underline;">H<span class="TextRun Underlined SCXW233229873 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun SCXW233229873 BCX0" data-ccp-parastyle="Normal (Web)">ere&#8217;s</span> <span class="NormalTextRun SCXW233229873 BCX0" data-ccp-parastyle="Normal (Web)">a possible attack</span><span class="NormalTextRun SCXW233229873 BCX0" data-ccp-parastyle="Normal (Web)"> scenario:</span></span><span class="EOP SCXW233229873 BCX0" data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></span></p>
<p><span data-contrast="auto">Once the victim&#8217;s EMR service writes files to the attacker&#8217;s bucket, the attacker can exploit this by injecting malicious code. In this scenario, a Lambda function injects malicious code into a Jupyter notebook (.ipynb) file written by the victim&#8217;s EMR service to the attacker&#8217;s bucket. This can result in a cross-site scripting (XSS) attack when the user opens the notebook in EMR Studio.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">For example, the attacker could redirect the user to a spoofed AWS login page to steal their credentials. Even worse, if the role assigned to the service has higher permissions, the attacker could create resources or compromise the entire account.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">It&#8217;s important to mention that when a user tries to create a new studio in EMR, AWS by default suggests creating a service role named </span><code>AmazonEMRStudio_ServiceRole_{ID}</code><span data-contrast="auto"> with relevant permissions for the service – “</span><i><span data-contrast="auto">We will create a service role for you using the name …”.</span></i><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">This role includes actions like </span><code>Put</code><span data-contrast="auto"> and </span><code>Get</code><span data-contrast="auto"> for objects to and from the </span><code>aws-emr-studio-{Account-ID}-{Region}</code>.</p>
<p><span data-contrast="auto">However, AWS enforces a condition in the policy to check the </span><code>aws:ResourceAccount</code><span data-contrast="auto"> of the S3 bucket used by the EMR. This ensures that the S3 bucket belongs to the victim&#8217;s account. In our case, since the S3 bucket that EMR will try to interact with is associated with a different account (the attacker), this will trigger an error message and prevent the creation of the EMR studio. </span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span style="text-decoration: underline;">At this point, the user has two options to successfully create the studio: </span></p>
<ol>
<li><b><span data-contrast="auto">Choose an Existing Role:</span></b><span data-contrast="auto"> Typically, users might choose an existing role. Often, the chosen role may have </span><b><span data-contrast="auto">s3:*</span></b><span data-contrast="auto"> permissions without the </span><code>aws:ResourceAccount</code><span data-contrast="auto"> restriction. While this allows the EMR studio to be deployed, it also potentially grants overly permissive privileges that could be exploited by an attacker.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">Follow Suggested Permissions by AWS:</span></b><span data-contrast="auto"> The user can follow the permission details suggested by the EMR service and create a similar role. This time, the creation of the EMR studio will succeed because the AWS Management Console permission details for </span><code>AmazonEMRStudio_ServiceRole_{ID}</code><span data-contrast="auto"> do not include the </span><code>aws:ResourceAccount</code><span data-contrast="auto"> condition. </span><b><span data-contrast="auto">This condition is only added if AWS creates the role for the user.</span></b><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
</ol>
<div id="attachment_21191" style="width: 1010px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/14.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21191" class="wp-image-21191" src="../../wp-content/uploads/2024/07/14.jpg" alt="The IAM policy for a role created by AWS is more restrictive compared to the policy AWS recommends " width="1000" height="674" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/14.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/14-300x202.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/14-1024x690.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/14-768x518.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/14-140x94.jpg 140w" sizes="(max-width: 1000px) 100vw, 1000px" /></a><p id="caption-attachment-21191" class="wp-caption-text">The IAM policy for a role created by AWS is more restrictive compared to the policy AWS recommends</p></div>
<p><span data-contrast="auto">Here is a Proof of Concept (PoC) video demonstrating the vulnerability:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div style="width: 640px;" class="wp-video"><video class="wp-video-shortcode" id="video-21174-3" width="640" height="360" preload="metadata" controls="controls"><source type="video/mp4" src="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/EMR.mp4?_=3" /><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/EMR.mp4">https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/EMR.mp4</a></video></div></div>
<p><a name="section-12" class="anchor_offset"></a></p>
<div id="section_wrap_12" class="toc_section_wrap">
<h3>AWS SageMaker Vulnerability: “sagemaker-{Region}-{Account-ID}”</h3>
<p><span data-contrast="auto">AWS SageMaker is a service for building, training, and deploying machine learning models at scale, offering comprehensive tools for the entire workflow.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Amazon SageMaker Canvas, part of this ecosystem, is a </span><strong>no-code</strong><span data-contrast="auto">, visual platform that enables non-developers and business analysts to develop, train, and deploy models easily.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">In our research, we discovered that when the user creates a SageMaker Canvas, the SageMaker service automatically creates an S3 bucket to store files utilized by the service. This S3 bucket is named according to the pattern: </span><code>sagemaker-{Region}-{Account-ID}</code>.</p>
<div id="attachment_21192" style="width: 610px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/15.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21192" class="wp-image-21192" src="../../wp-content/uploads/2024/07/15.jpg" alt="The S3 bucket created by the SageMaker Canvas " width="600" height="429" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/15.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/15-300x215.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/15-1024x732.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/15-768x549.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/15-140x100.jpg 140w" sizes="(max-width: 600px) 100vw, 600px" /></a><p id="caption-attachment-21192" class="wp-caption-text">The S3 bucket created by the SageMaker Canvas</p></div>
<p><span data-contrast="auto">There is nothing new under the sun – this bucket is predictable, allowing an attacker to claim it before the user&#8217;s initial service usage. In this case the attacker only needs the AWS account ID and a chosen region. They can then configure the bucket for public access and establish a permissive bucket policy that grants the victim full access to the external S3 bucket.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div id="attachment_21193" style="width: 1008px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/16.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21193" class="wp-image-21193" src="../../wp-content/uploads/2024/07/16.jpg" alt="Overview of SageMaker vulnerability " width="998" height="246" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/16.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/16-300x74.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/16-1024x252.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/16-768x189.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/16-140x35.jpg 140w" sizes="(max-width: 998px) 100vw, 998px" /></a><p id="caption-attachment-21193" class="wp-caption-text">Overview of SageMaker vulnerability</p></div>
<p><span style="text-decoration: underline;">Here’s a possible attack scenario for SageMaker: </span></p>
<p><span data-contrast="auto">In this attack scenario, the threat is more relevant to information disclosure and data manipulation. Each time a SageMaker Canvas user tries to create a dataset or import data into the service, this data will be written to the attacker&#8217;s S3 bucket (under </span><code>Canvas/default-{Time}/*</code><span data-contrast="auto">). Later, this data will be used by the SageMaker Canvas service for the user, leading to significant risks such as:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<ul>
<li><b><span data-contrast="auto">Data Leakage:</span></b><span data-contrast="auto"> Sensitive training data could be exposed to the attacker.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
<li><b><span data-contrast="auto">Data Manipulation:</span></b><span data-contrast="auto"> The attacker could modify the dataset, leading to inaccurate models or other malicious outcomes.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></li>
</ul>
<p><span data-contrast="auto">Here is a Proof of Concept (PoC) video demonstrating the vulnerability:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div style="width: 640px;" class="wp-video"><video class="wp-video-shortcode" id="video-21174-4" width="640" height="360" preload="metadata" controls="controls"><source type="video/mp4" src="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/SageMaker.mp4?_=4" /><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/SageMaker.mp4">https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/SageMaker.mp4</a></video></div></div>
<p><a name="section-13" class="anchor_offset"></a></p>
<div id="section_wrap_13" class="toc_section_wrap">
<h3>AWS CodeStar Vulnerability: “aws-codestar-{Region}-{Account-ID}”</h3>
<p><span data-contrast="auto">AWS CodeStar is a service that simplifies project management by integrating AWS development tools for coding, building, and deploying applications.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">In our research, we found that when a CodeStar project is created, the CodeStar service automatically generates an S3 bucket for the used. This S3 bucket is named following the pattern: </span><code>aws-codestar-{Region}-{Account-ID}</code>.<span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p>H<span data-contrast="auto">ere’s a possible attack scenario for CodeStar:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div id="attachment_21194" style="width: 1009px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/17.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21194" class="wp-image-21194" src="../../wp-content/uploads/2024/07/17.jpg" alt="Overview of CodeStar vulnerability " width="999" height="277" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/17.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/17-300x83.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/17-1024x284.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/17-768x213.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/17-140x39.jpg 140w" sizes="(max-width: 999px) 100vw, 999px" /></a><p id="caption-attachment-21194" class="wp-caption-text">Overview of CodeStar vulnerability</p></div>
<p><span data-contrast="auto">Similar to the previous case, if the bucket name is seized by an attacker, the legitimate user won’t be able to use the service and will receive a </span><i><span data-contrast="auto">&#8220;Project creation failed</span></i><span data-contrast="auto">” message when attempting to create a CodeStar project. </span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div id="attachment_21195" style="width: 1013px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/18.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21195" class="wp-image-21195" src="../../wp-content/uploads/2024/07/18.jpg" alt="An error message will appear on the victim's side because the attacker has already claimed the bucket that CodeStar will attempt to use " width="1003" height="154" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/18.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/18-300x46.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/18-1024x157.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/18-768x118.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/18-140x22.jpg 140w" sizes="(max-width: 1003px) 100vw, 1003px" /></a><p id="caption-attachment-21195" class="wp-caption-text">An error message will appear on the victim&#8217;s side because the attacker has already claimed the bucket that CodeStar will attempt to use</p></div>
<p><span data-contrast="auto">This happens because the necessary bucket for the service already exists </span><span data-contrast="auto">under the attacker&#8217;s account. Essentially, this creates a Denial of Service (DoS) scenario, where the attacker prevents the user from using a specific AWS service.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">Here is a Proof of Concept (PoC) video demonstrating the vulnerability:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div style="width: 640px;" class="wp-video"><video class="wp-video-shortcode" id="video-21174-5" width="640" height="360" preload="metadata" controls="controls"><source type="video/mp4" src="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/CodeStar.mp4?_=5" /><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/CodeStar.mp4">https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/CodeStar.mp4</a></video></div></div>
<p><a name="section-14" class="anchor_offset"></a></p>
<div id="section_wrap_14" class="toc_section_wrap">
<h3>AWS Service Catalog Vulnerability: “cf-templates-{Hash}-{Region}”</h3>
<p><span data-contrast="auto">In AWS, the Service Catalog is a tool designed to help organizations create and manage catalogs of approved resources for use on AWS. The Service Catalog helps ensure standardization, compliance with organizational policies, and enables users to quickly deploy only approved services.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">Typically, a privileged user in AWS will create portfolios in AWS Service Catalog to organize products and distribute them to end users. A product in AWS Service Catalog is a set of AWS resources that can include EC2 instances, storage volumes, databases, etc. These resources are then available for deployment in AWS to other users.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">There are several methods to add a product to the Service Catalog, one of which is using AWS CloudFormation. If this method is chosen, the user has the option to upload a CloudFormation template. When a CloudFormation template is uploaded, AWS Service Catalog creates an S3 bucket to store the template. </span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">In our research, we discovered that the S3 bucket storing the CloudFormation template is named according to the pattern</span><b><span data-contrast="auto">: </span></b><code>cf-templates-{HASH}-{Account-ID}</code><span data-contrast="auto">.</span> <span data-contrast="auto">This pattern is predictable by attackers who have the CloudFormation hash of organizations (and remains consistent across regions). This reveals the same vulnerability we identified in our initial CloudFormation analysis (the first vulnerability). </span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div id="attachment_21196" style="width: 610px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/19.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21196" class="wp-image-21196" src="../../wp-content/uploads/2024/07/19.jpg" alt="The S3 bucket created by the Service Catalog" width="600" height="402" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/19.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/19-300x201.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/19-1024x687.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/19-768x515.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/19-140x94.jpg 140w" sizes="(max-width: 600px) 100vw, 600px" /></a><p id="caption-attachment-21196" class="wp-caption-text">The S3 bucket created by the Service Catalog</p></div>
<p><span class="TextRun SCXW245262551 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun SCXW245262551 BCX0">This vulnerability can allow an attacker to inject remote resources into a Service Catalog product&#8217;s CloudFormation template file, enabling the deployment of malicious resources or, in some cases, adding an admin user that can be assumed by the attacker.</span></span><span class="EOP SCXW245262551 BCX0" data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<div id="attachment_21197" style="width: 1410px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/20.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21197" class="wp-image-21197 size-full" src="../../wp-content/uploads/2024/07/20.jpg" alt="Overview of Service Catalog vulnerability " width="1400" height="392" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/20.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/20-300x84.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/20-1024x287.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/20-768x215.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/20-140x39.jpg 140w" sizes="(max-width: 1400px) 100vw, 1400px" /></a><p id="caption-attachment-21197" class="wp-caption-text">Overview of Service Catalog vulnerability</p></div>
<p><span style="text-decoration: underline;"><span class="NormalTextRun SCXW47698517 BCX0">Here</span><span class="NormalTextRun SCXW47698517 BCX0">’</span><span class="NormalTextRun SCXW47698517 BCX0">s</span> <span class="NormalTextRun SCXW47698517 BCX0">a possible attack</span><span class="NormalTextRun SCXW47698517 BCX0"> scenario</span><span class="NormalTextRun SCXW47698517 BCX0"> for Service</span> <span class="NormalTextRun SCXW47698517 BCX0">Catalog:</span></span></p>
<p><span data-contrast="auto">An important disclaimer concerning the impact of this vulnerability. The privileges that the template deployment process has may vary, so injecting a malicious role will be heavily dependent on the user who launched the product. </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Nevertheless, with this vulnerability the attacker can modify an existing resource that was deployed by the legitimate user and plant a backdoor in it. </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Additionally, some product creators (usually privileged users) choose to use </span><a href="https://docs.aws.amazon.com/servicecatalog/latest/adminguide/constraints-launch.html" target="_blank" rel="noopener"><span data-contrast="none">Launch Constraints</span></a><span data-contrast="auto">, allowing them to specify the IAM role that AWS Service Catalog will assume when deploying the product, regardless of the permissions of the user who launches the product. </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">This is particularly useful for enabling users with limited permissions to deploy resources securely. In this case, an attacker can exploit this, since even if the user has low privileges, the deployment process of the product might have higher permissions granted by an admin.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Here is a Proof of Concept (PoC) video demonstrating the vulnerability:</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div style="width: 640px;" class="wp-video"><video class="wp-video-shortcode" id="video-21174-6" width="640" height="360" preload="metadata" controls="controls"><source type="video/mp4" src="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Service Catalog.mp4?_=6" /><a href="https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Service Catalog.mp4">https://1665891.fs1.hubspotusercontent-na1.net/hubfs/1665891/Service%20Catalog.mp4</a></video></div></div>
<p><a name="section-15" class="anchor_offset"></a></p>
<div id="section_wrap_15" class="toc_section_wrap">
<h3 aria-level="3"><span data-contrast="none">Shadow Resource Attack Vector in Open Source</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p><span data-contrast="auto">During our research, we identified that this attack vector affects not only AWS services but also many open-source projects used by organizations to deploy resources in their AWS environments. Many open-source projects create S3 buckets automatically as part of their functionality or instruct their users to deploy S3 buckets. For example, they might provide a command like </span><code>sam deploy --s3-bucket PREFIX-$AWS_ACCOUNT_ID-$AWS_REGION…</code><span data-contrast="auto">. These buckets often use a constant prefix and the user&#8217;s account ID to create unique bucket names, sometimes also including the region where the service or logic will be deployed. This is very dangerous, as we have seen. An attacker with your organization&#8217;s account ID or other unique identifiers can create the bucket before the victim does.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><script src="../../../gist.github.com/yakirk/07ac52fff7add1387abd24d54271e50d.js"></script></p>
<table style="height: 24px; width: 100%; border-collapse: collapse; background-color: #d5dce6;">
<tbody>
<tr style="height: 24px;">
<td style="width: 100%; height: 24px; text-align: center;">Example of a bash script that checks if a bucket exists before creating it. This snippet is problematic because the existence of the S3 bucket won’t fail the run</td>
</tr>
</tbody>
</table>
<p style="text-align: left;"><span data-contrast="auto">The consequences vary depending on the logic of the open-source project. In some projects the process will fail if the bucket already exists and lets you choose another bucket name. In other cases, the process will completely fail. There are some cases, however, that write their data to the attacker&#8217;s claimed bucket, giving the attacker full access to the files. This allows the attacker to potentially modify the files and perform malicious actions in your account, possibly even taking it over, depending on the permissions of the deployer or the service/logic that will use the manipulated file later.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><script src="../../../gist.github.com/yakirk/40c8d60626406a071309072b2186a789.js"></script></p>
<table style="width: 99.0833%; border-collapse: collapse; background-color: #d5dce6; height: 51px;">
<tbody>
<tr>
<td style="width: 100%; text-align: center;"> Example of a script that tries to check if a bucket exists. However, this script is still vulnerable because an attacker who claims the bucket before the victim and sets permissive policies can cause the first condition (<code>! aws s3 ls…</code>)  to be bypassed, leading to other checks being skipped</td>
</tr>
</tbody>
</table>
<p><span data-contrast="auto">Another interesting point is that knowing the predictable S3 bucket names of open-source and other AWS services could previously lead to a </span><a href="https://medium.com/@maciej.pocwierz/how-an-empty-s3-bucket-can-make-your-aws-bill-explode-934a383cb8b1" target="_blank" rel="noopener"><span data-contrast="none">&#8220;Denial of Wallet&#8221; attack</span></a><span data-contrast="auto">, as demonstrated a few months ago. This attack vector has since been mitigated by AWS.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span>
</div>
<p><a name="section-16" class="anchor_offset"></a></p>
<div id="section_wrap_16" class="toc_section_wrap">
<h3><span data-contrast="none">Past Services Affected by Shadow Resources</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></h3>
<p><span data-contrast="auto">We observed services that were vulnerable to this vector in the past, but now they are fixed. For example, the </span><a href="https://aws.amazon.com/athena/" target="_blank" rel="noopener"><span data-contrast="none">Athena service</span></a><span data-contrast="auto"> previously would create a default S3 bucket for query results if none was already specified. The default bucket followed the format </span><code>aws-athena-query-results-MyAcctID-MyRegion</code><span data-contrast="auto">, which is predictable and could be claimed by attackers. Now, Athena requires users to specify an S3 bucket for query results, thereby AWS Athena is no longer vulnerable to this attack vector.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><div id="attachment_21198" style="width: 810px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/23.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21198" class="wp-image-21198" src="../../wp-content/uploads/2024/07/23.jpg" alt="The AWS documentation states that AWS no longer creates a default location with the format aws-athena-query-results-MyAcctID-MyRegion for users" width="800" height="622" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/23.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/23-300x233.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/23-1024x797.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/23-768x597.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/23-140x109.jpg 140w" sizes="(max-width: 800px) 100vw, 800px" /></a><p id="caption-attachment-21198" class="wp-caption-text">The AWS documentation states that AWS no longer creates a default location with the format aws-athena-query-results-MyAcctID-MyRegion for users</p></div>
</div>
<p><a name="section-17" class="anchor_offset"></a></p>
<div id="section_wrap_17" class="toc_section_wrap">
<h3 aria-level="1"><span data-contrast="none">AWS account ID is a Secret</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p><span data-contrast="auto">The question of whether an AWS account ID should be considered a secret has long been debated among security researchers and AWS users. Opinions vary &#8211; </span><a href="http://xn--%09https-mr3d/www.lastweekinaws.com/blog/are-aws-account-ids-sensitive-information/" target="_blank" rel="noopener"><span data-contrast="none">some believe</span></a><span data-contrast="auto"> the AWS account ID is not a secret, while others argue that it should be kept confidential (you can read Daniel Grzelak great </span><a href="https://blog.plerion.com/aws-account-ids-are-secrets/" target="_blank" rel="noopener"><span data-contrast="none">blog post</span></a><span data-contrast="auto"> on the reasons why).</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Generally, the trend over the years has been to advise organizations to keep their AWS account ID secret if possible. Although the common assumption is that knowing an account ID alone is not sufficient to hack an account, attackers might still use it to </span><a href="https://rhinosecuritylabs.com/aws/assume-worst-aws-assume-role-enumeration/" target="_blank" rel="noopener"><span data-contrast="none">gather information</span></a><span data-contrast="auto"> about your AWS account, and more.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">AWS also mentions in their </span><a href="https://docs.aws.amazon.com/accounts/latest/reference/manage-acct-identifiers.html" target="_blank" rel="noopener"><span data-contrast="none">documentation</span></a><span data-contrast="auto"> they, “</span><i><span data-contrast="auto">While account IDs, like any identifying information, should be used and shared carefully, they are not considered secret, sensitive, or confidential information</span></i><span data-contrast="auto">”.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><strong><span class="TextRun MacChromeBold SCXW113362745 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="auto"><span class="NormalTextRun CommentStart CommentHighlightPipeRestV2 CommentHighlightRest SCXW113362745 BCX0">However, based on our research, we strongly believe that account IDs should be considered secrets, since there may be other kinds of similar exploits that could be carried out based on knowing an account ID.</span></span><span class="EOP CommentHighlightPipeRestV2 SCXW113362745 BCX0" data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span> </strong>
</div>
<p><a name="section-18" class="anchor_offset"></a></p>
<div id="section_wrap_18" class="toc_section_wrap">
<h3><span class="TextRun MacChromeBold SCXW260985233 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="none"><span class="NormalTextRun SCXW260985233 BCX0" data-ccp-charstyle="Strong">Bucket Monopoly</span></span></h3>
<p><span class="EOP SCXW260985233 BCX0" data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"><span class="NormalTextRun CommentStart CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">In </span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">previous</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)"> vulnerabilities, we targeted specific regions of other accounts. However, instead of focusing on one region, we could claim all </span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">possible regions</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)"> the user </span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">hasn’t</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)"> claimed yet. In the following section, we will describe our technique called &#8220;</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">B</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">ucket </span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">M</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">onopoly.&#8221; While this method is no longer relevant to the services found vulnerable in this research </span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">because</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)"> the issue</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">s hav</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">e</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)"> be</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">en</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)"> fixed, it is particularly relevant for open-source projects and undiscovered vulnerable components. This strategy increases the likelihood of an unsuspecting victim interacting with </span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">this attacker</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)"> owned S3 </span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">buckets, potentially leading to complete account compromise or other malicious actions if the</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)"> vulnerable</span> <span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)">component</span><span class="NormalTextRun CommentHighlightClicked SCXW142024435 BCX0" data-ccp-parastyle="Normal (Web)"> has a predictable S3 bucket name.</span></span></p>
<div id="attachment_21199" style="width: 778px" class="wp-caption aligncenter"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21199" class="wp-image-21199 size-large" src="../../wp-content/uploads/2024/07/24-1024x985.jpg" alt="Instead of targeting a single region, an attacker could potentially claim all unclaimed regions for a specific S3 bucket pattern of a vulnerable component " width="768" height="739" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/24-1024x985.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/24-300x288.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/24-768x738.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/24-140x135.jpg 140w, https://www.aquasec.com/wp-content/uploads/2024/07/24.jpg 1400w" sizes="(max-width: 768px) 100vw, 768px" /><p id="caption-attachment-21199" class="wp-caption-text">Instead of targeting a single region, an attacker could potentially claim all unclaimed regions for a specific S3 bucket pattern of a vulnerable component</p></div>
<p><span data-contrast="auto">Since S3 bucket names are globally unique, we can check which buckets exist and are already claimed by the victim’s account because we know the exact bucket name pattern their vulnerable component will use in each region. By creating GET requests to </span><code>Prefix-{Hash}-{Region}.s3.amazonaws.com</code><span data-contrast="auto"> (or another pattern), we can determine if a bucket exists or if it is free, indicated by a </span><code>NoSuchBucket</code><span data-contrast="auto"> message.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">By doing this, we can identify all the regions the victim hasn&#8217;t yet utilized for the component service or open-source project. We can then set up buckets and Lambda functions(optional) in all these unclaimed regions and wait for the victim to use them. AWS currently has </span><a href="https://aws.amazon.com/about-aws/global-infrastructure/" target="_blank" rel="noopener"><span data-contrast="none">33 regions</span></a><span data-contrast="auto">, so even if the victim has already created the predictable bucket name in all available regions, an attacker can wait for a new region to be released and immediately claim the predictable bucket name.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><div id="attachment_21200" style="width: 778px" class="wp-caption aligncenter"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21200" class="wp-image-21200 size-large" src="../../wp-content/uploads/2024/07/25-1024x1005.jpg" alt="When the user uses the vulnerable component for the first time in a new region, the vulnerable component will interact with the attacker's controlled S3 bucket" width="768" height="754" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/25-1024x1005.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/25-300x294.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/25-768x754.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/25-140x137.jpg 140w, https://www.aquasec.com/wp-content/uploads/2024/07/25.jpg 1400w" sizes="(max-width: 768px) 100vw, 768px" /><p id="caption-attachment-21200" class="wp-caption-text">When the user uses the vulnerable component for the first time in a new region, the vulnerable component will interact with the attacker&#8217;s controlled S3 bucket</p></div>
</div>
<p><a name="section-19" class="anchor_offset"></a></p>
<div id="section_wrap_19" class="toc_section_wrap">
<h3 aria-level="3"><span data-contrast="none">Bucket Monopoly Step-by-Step:</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<ul>
<li><b>Step 1 &#8211; Identifying Bucket Naming Conventions:</b><span data-contrast="auto"> To find shadow resources, we often rely on identifying predictable bucket naming conventions. We start reconnaissance by looking for bucket names that contain a prefix or postfix along with an identifier like an Account ID or hash, and optionally, a region (Including the region in the pattern increases the likelihood that the same service will be deployed in multiple regions). This reconnaissance can be achieved by using GitHub Regex Search to identify common patterns, crawling AWS services using tools like TrailShark or reviewing AWS documentation.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
<li><b>Step 2 &#8211;  Discovering the Unique Identifier of the Bucket Naming Conventions:</b><span data-contrast="auto"> Predictable bucket names often contain unique identifiers to distinguish between different accounts that deploy the bucket. In most cases, this identifier is the public Account ID of the victim. However, sometimes it is a unique hash (CloudFormation, Service Catalog). If this is the case, attackers will try to determine if this hash has been accidentally leaked. Public Account IDs are widely exposed, and attackers have many ways to obtain them. Here are a few examples:</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
<ul>
<li><strong>Using GitHub Search/Sourcegraph</strong><span data-contrast="auto"><strong>:</strong> Attackers can find many exposed account IDs by querying patterns like </span><code>/arn:aws:iam::[0-9]{12}/</code><b><span data-contrast="auto">, </span></b>which<span data-contrast="auto"> will return the public Account ID after the </span><code>arn:aws:iam::</code><span data-contrast="auto"> part, currently there are </span><b><span data-contrast="auto">157k results</span></b><span data-contrast="auto"> for this on GitHub.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
<li><strong>Collecting S3 Bucket Names</strong><span data-contrast="auto"><strong>:</strong> Attackers can gather S3 bucket names from platforms like GitHub or </span><a href="https://grayhatwarfare.com/" target="_blank" rel="noopener"><span data-contrast="none">GrayhatWarfare</span></a><span data-contrast="auto">, which collects exposed buckets and other resources, and then use these to </span><a href="https://tracebit.com/blog/how-to-find-the-aws-account-id-of-any-s3-bucket" target="_blank" rel="noopener"><span data-contrast="none">find the AWS Account ID from the bucket name</span></a><span data-contrast="auto">, </span><span data-contrast="auto">Using this method, </span><a href="https://www.youtube.com/watch?v=iMYbne-tD20&amp;ab_channel=fwd%3Acloudsec" target="_blank" rel="noopener"><span data-contrast="none">Jarom Brown was able to collect</span></a><span data-contrast="auto"> nearly </span><b><span data-contrast="auto">197k unique account IDs</span></b><span data-contrast="auto">. </span></li>
<li><strong>Reverting Account ID from AWS Access Key ID</strong><span data-contrast="auto"><strong>:</strong> It&#8217;s possible to derive the Account ID from an AWS Access Key ID. You can read an excellent </span><a href="https://medium.com/@TalBeerySec/a-short-note-on-aws-key-id-f88cc4317489" target="_blank" rel="noopener"><span data-contrast="none">blog by Tal Be&#8217;ery</span></a><span data-contrast="auto"> on this topic, which is based on research by </span><a href="https://summitroute.com/blog/2018/06/20/aws_security_credential_formats/" target="_blank" rel="noopener"><span data-contrast="none">Aidan Steele</span></a><span data-contrast="auto">. </span></li>
</ul>
</li>
</ul>
<p style="padding-left: 40px;">An even more valuable resource is the list of <a href="https://github.com/fwdcloudsec/known_aws_accounts/blob/main/accounts.yaml" target="_blank" rel="noopener">Known AWS Accounts</a>, which includes account IDs from numerous large organizations and vendors. Another list of <a href="https://github.com/righteousgambit/quiet-riot/blob/main/wordlists/known_valid_account_ids.txt" target="_blank" rel="noopener">known valid account IDs</a> contains over 38,000 valid account IDs.</p>
<p style="padding-left: 40px;">During our research, we identified several organizations that used predictable AWS s3 bucket of the AWS Glue service aws-glue-assets-{Account-ID}-{Region}, based on this list. We observed cases where organizations had deployed AWS Glue S3 buckets in at least two regions, with others extending to three or four regions. This pattern indicates that organizations might expand the previously vulnerable service to other regions where attackers control the buckets used by the previously vulnerable service.</p>
<ul>
<li><b><span data-contrast="auto">Step 3 &#8211; Creating Unclaimed Buckets Across All Regions</span></b><span data-contrast="auto">: Attackers utilize their understanding of naming conventions and account IDs to strategically create S3 buckets with predictable names across all AWS regions where the buckets do not yet exist. Then, the attacker opens the bucket for public access and defines a permissive policy. Specifically, if the attacker knows the victim&#8217;s Account ID, they can configure the bucket to allow access only from the victim&#8217;s account by setting </span><code>"Principal": {"AWS": "arn:aws:iam::{Victim-Account-ID}:root"}</code><span data-contrast="auto">.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
</ul>
<p><span data-contrast="auto">By doing so, they position themselves to intercept the victim’s future interactions with these S3 buckets. Essentially, the attacker monopolizes all the buckets related to the vulnerable service across various AWS regions, waiting for the victim to start and use the vulnerable services.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559685&quot;:720,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
</div>
<p><a name="section-20" class="anchor_offset"></a></p>
<div id="section_wrap_20" class="toc_section_wrap">
<h3 aria-level="1"><span data-contrast="none">How AWS address these vulnerabilities</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p aria-level="1"><span data-contrast="auto">After our report in February 2024, AWS began addressing the vulnerabilities we identified (you can view the full timeline at the beginning of this blog), making this attack vector no longer possible in CloudFormation, Glue, EMR, SageMaker, and Service Catalog. While the specifics of the fixes vary among these services, the general approach is consistent: if a bucket already exists, AWS will either add a sequence/random number or prompt the user to choose a new bucket name, thereby ignoring the attacker’s claimed bucket.</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Regarding CodeStar, the issue is considered addressed since new customers are no longer allowed to create projects, as the service is planned for deprecation in July 2024.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<p><span data-contrast="auto">We have also observed cases where AWS notifies users about resources that will be created for service operations. This is a good way to inform users, helping them understand that some services create S3 buckets during their operation, and that these buckets should be handled securely.</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></p>
<div id="attachment_21201" style="width: 810px" class="wp-caption aligncenter"><a href="../../wp-content/uploads/2024/07/26.jpg" class="modal-inline-image"><img loading="lazy" decoding="async" aria-describedby="caption-attachment-21201" class="wp-image-21201" src="../../wp-content/uploads/2024/07/26.jpg" alt="CloudFormation Application Composer notifies the user about the S3 bucket that will be created" width="800" height="419" srcset="https://www.aquasec.com/wp-content/uploads/2024/07/26.jpg 1400w, https://www.aquasec.com/wp-content/uploads/2024/07/26-300x157.jpg 300w, https://www.aquasec.com/wp-content/uploads/2024/07/26-1024x536.jpg 1024w, https://www.aquasec.com/wp-content/uploads/2024/07/26-768x402.jpg 768w, https://www.aquasec.com/wp-content/uploads/2024/07/26-140x73.jpg 140w" sizes="(max-width: 800px) 100vw, 800px" /></a><p id="caption-attachment-21201" class="wp-caption-text">CloudFormation Application Composer notifies the user about the S3 bucket that will be created</p></div>
<p><span data-contrast="auto">Regarding whether an attacker used this vector previously, AWS has indicated that they </span><i><span data-contrast="auto">“are confirming the results of each team’s investigation and will contact customers directly in the event they are affected by any of the reported issues”</span></i><span data-contrast="auto">.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span>
</div>
<p><a name="section-21" class="anchor_offset"></a></p>
<div id="section_wrap_21" class="toc_section_wrap">
<h3 aria-level="1"><span data-contrast="none">Summary, Mitigations and Recommendations</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></h3>
<p><span data-contrast="auto">In this blog we reported about 6 vulnerabilities in AWS services, that might enable an attacker to exploit an organization that uses AWS when the most severe impact can be a complete account takeover on the AWS account.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">We explained how these vulnerabilities occur, we dubbed a new attack vector named ‘Shadow Resources’. We also depicted a technique that can be used to maximize the impact of this attack vector. </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">While the vulnerabilities in the above-mentioned services were mitigated by AWS, this attack vector can still apply on other AWS services and open-source projects. </span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<p><span data-contrast="auto">Therefore, it is essential to implement certain mitigations and measures:</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<ul>
<li data-leveltext="%1." data-font="" data-listid="48" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><span style="text-decoration: underline;"><b>‘aws:ResourceAccount’ Condition:</b></span><span data-contrast="auto"> To prevent a user or a service role from accessing a bucket you don&#8217;t trust, you can define a scoped policy for the role used or assumed by the service and include the </span><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html" target="_blank" rel="noopener"><span data-contrast="none">Condition element</span></a><span data-contrast="auto"> in the JSON policy. By using the</span><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_condition-keys.html#condition-keys-resourceaccount" target="_blank" rel="noopener"> <b><span data-contrast="none">aws:ResourceAccount</span></b><span data-contrast="none"> condition</span></a><span data-contrast="auto">, you can check the resource owner&#8217;s AWS account ID of the bucket. For example, the default service role that EMR Studio creates for users is called </span><code>AmazonEMRStudio_ServiceRole_{ID}</code><span data-contrast="auto"> and includes the necessary permissions for the service to operate. In this role, AWS enforces the </span><code>aws:ResourceAccount</code><span data-contrast="auto"> condition in the policy to check that the AWS account ID of the S3 bucket used by EMR is owned by the user himself. This effectively prevents users from accessing and writing data into an S3 bucket owned by an attacker. Here is an example of this implementation:</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
</ul>
<p><script src="../../../gist.github.com/yakirk/f154d9bc42d1f2c0bf6768ca206c7e78.js"></script></p>
<table style="width: 100%; border-collapse: collapse; background-color: #d5dce6;">
<tbody>
<tr>
<td style="width: 100%; text-align: center;">An example to a policy that uses the AWS condition that checks the resource owner</td>
</tr>
</tbody>
</table>
<p>It is important to mention that some AWS services require access to resources hosted in another AWS account. Using <code>aws:ResourceAccount</code><span data-contrast="auto"> in your identity-based policies might impact your identity&#8217;s ability to access these resources, so this needs to be checked and verified.</span></p>
<ul>
<li data-leveltext="%1." data-font="" data-listid="48" data-list-defn-props="{&quot;335552541&quot;:0,&quot;335559685&quot;:720,&quot;335559991&quot;:360,&quot;469769242&quot;:[65533,0],&quot;469777803&quot;:&quot;left&quot;,&quot;469777804&quot;:&quot;%1.&quot;,&quot;469777815&quot;:&quot;hybridMultilevel&quot;}" aria-setsize="-1" data-aria-posinset="1" data-aria-level="1"><b><span data-contrast="auto">Verify the expected bucket owner:</span></b><span data-contrast="auto"> We recommend verifying the owner of the S3 bucket using the name pattern mentioned in the blog to ensure that the S3 buckets used by your service are indeed under your account. This can be done using the command: </span></li>
</ul>
<p><script src="../../../gist.github.com/yakirk/46940e6a32ecb09e9e851a44dd385d74.js"></script></p>
<p><span data-contrast="auto">For example: You can perform an extended search for predictable patterns like </span><code>aws-glue-assets-{Account-ID}-{Region}</code><span data-contrast="auto">. In this case, you will need to check the glue bucket owner for every AWS region with your AWS account ID. If you receive an </span>Access Denied<span data-contrast="auto"> message, this indicates that the bucket is not under your account, and you should verify the owner of the bucket and whether you trust this account.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}">  </span>The <b><span data-contrast="auto">&#8211;expected-bucket-owner</span></b><span data-contrast="auto"> check is also </span><strong>valuable for open-source</strong><span data-contrast="auto"><strong> projects</strong> that create S3 buckets as part of their operation to safely verify if the bucket has been claimed by someone else. If so, you will need to create a new S3 bucket with a different name.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559685&quot;:720,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></p>
<ul>
<li><b><span data-contrast="auto">Naming S3 Buckets:</span></b><span data-contrast="auto"> Instead of using predictable or static identifiers in the bucket name, it is advisable to generate a unique hash or a random identifier for each region and account, incorporating this value into the S3 bucket name. This approach helps protect against attackers claiming your bucket prematurely.</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:259}"> </span></li>
</ul>
<p>&nbsp;</p></div>
					


					
					



				</div><!-- content -->

						
			</div><!-- main_content_column -->


			
			<div class="trd-ph-embedded match_blog_width" data-id="ac25252f-46f9-4952-bdc4-33b23e371131"></div>


			<div id="post_footer_meta" class="post_footer_meta match_blog_width">
				<p><strong>Published under:</strong> <a href="../../category/research/index.html" rel="category tag">SECURITY RESEARCH</a></p>
							</div><!-- post_meta -->
			<div class="spacer"></div>
			<div class="match_blog_width">
			

	<div class="author_card with_avatar">

			<div class="author_avatar" style="background-image:url('../../wp-content/uploads/2024/01/Yakir-K-140x140.jpg');"></div>
		
						<a href="../../authors/yakir-kadkoda/index.html" class="author_name">Yakir Kadkoda</a>
			
			<div class="author_bio">Yakir Kadkoda is a Lead Security Researcher at Aqua's research team, Team Nautilus. He combines his expertise in vulnerability research with a focus on discovering and analyzing new security threats and attack vectors in cloud native environments, supply chain security, and CI/CD processes. Prior to joining Aqua, Yakir worked as a red teamer. Yakir has shared his deep cybersecurity insights at major industry events like Black Hat and RSA.</div><!-- author_bio -->
	
			<div class="author_social_links">
			<div class="social_links_wrap small_social_links">
									<a href="https://www.linkedin.com/in/yakir-kadkoda?lipi=urn%3Ali%3Apage%3Ad_flagship3_profile_view_base_contact_details%3BeZHGPSEWTw60pu3BUApmPA%3D%3D" target="_blank" class="social_link linkedin"></a>
									<a href="https://twitter.com/YakirKad" target="_blank" class="social_link twitter"></a>
							</div>
		</div><!-- author_social_links -->
		
</div><!-- author_card -->


<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "Person",
"name": "Yakir Kadkoda",
"url": "https:\/\/www.aquasec.com\/authors\/yakir-kadkoda\/",
"image": "https:\/\/www.aquasec.com\/wp-content\/uploads\/2024\/01\/Yakir-K-140x140.jpg",
"description": "Yakir Kadkoda is a Lead Security Researcher at Aqua's research team, Team Nautilus. He combines his expertise in vulnerability research with a focus on discovering and analyzing new security threats and attack vectors in cloud native environments, supply chain security, and CI\/CD processes. Prior to joining Aqua, Yakir worked as a red teamer. Yakir has shared his deep cybersecurity insights at major industry events like Black Hat and RSA.",
"sameAs": ["https:\/\/www.linkedin.com\/in\/yakir-kadkoda?lipi=urn%3Ali%3Apage%3Ad_flagship3_profile_view_base_contact_details%3BeZHGPSEWTw60pu3BUApmPA%3D%3D","https:\/\/twitter.com\/YakirKad"]
}</script>



	<div class="author_card with_avatar">

			<div class="author_avatar" style="background-image:url('../../wp-content/uploads/2024/01/Ofek-Itach_SQ-140x140.jpg');"></div>
		
						<a href="../../authors/ofek-itach/index.html" class="author_name">Ofek Itach</a>
			
			<div class="author_bio">Ofek Itach is a Senior Security Researcher at Aqua, specializing in cloud research. His work focuses on identifying and analyzing attack vectors in cloud environments, enhancing security measures for cloud platforms and infrastructures. </div><!-- author_bio -->
	
			<div class="author_social_links">
			<div class="social_links_wrap small_social_links">
									<a href="https://www.linkedin.com/in/ofek-it?lipi=urn%3Ali%3Apage%3Ad_flagship3_profile_view_base_contact_details%3BDEdMTHzhQVWaoAfoEoOq5w%3D%3D" target="_blank" class="social_link linkedin"></a>
									<a href="https://x.com/ofekitach" target="_blank" class="social_link twitter"></a>
							</div>
		</div><!-- author_social_links -->
		
</div><!-- author_card -->


<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "Person",
"name": "Ofek Itach",
"url": "https:\/\/www.aquasec.com\/authors\/ofek-itach\/",
"image": "https:\/\/www.aquasec.com\/wp-content\/uploads\/2024\/01\/Ofek-Itach_SQ-140x140.jpg",
"description": "Ofek Itach is a Senior Security Researcher at Aqua, specializing in cloud research. His work focuses on identifying and analyzing attack vectors in cloud environments, enhancing security measures for cloud platforms and infrastructures. ",
"sameAs": ["https:\/\/www.linkedin.com\/in\/ofek-it?lipi=urn%3Ali%3Apage%3Ad_flagship3_profile_view_base_contact_details%3BDEdMTHzhQVWaoAfoEoOq5w%3D%3D","https:\/\/x.com\/ofekitach"]
}</script>



	<div class="author_card with_avatar">

			<div class="author_avatar" style="background-image:url('../../wp-content/uploads/2024/01/Michael-Katchinskiy-140x140.jpg');"></div>
		
						<a href="../../authors/michael-katchinskiy/index.html" class="author_name">Michael Katchinskiy</a>
			
			<div class="author_bio">Michael is a former Security Researcher at Team Nautilus, Aqua's research team. His work focuses on researching and analyzing new attack vectors and threats in cloud native environments. When he isn't at work, he enjoys a good kite-surfing session or making Neapolitan pizza.</div><!-- author_bio -->
	
	
</div><!-- author_card -->


<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "Person",
"name": "Michael Katchinskiy",
"url": "https:\/\/www.aquasec.com\/authors\/michael-katchinskiy\/",
"image": "https:\/\/www.aquasec.com\/wp-content\/uploads\/2024\/01\/Michael-Katchinskiy-140x140.jpg",
"description": "Michael is a former Security Researcher at Team Nautilus, Aqua's research team. His work focuses on researching and analyzing new attack vectors and threats in cloud native environments. When he isn't at work, he enjoys a good kite-surfing session or making Neapolitan pizza."}</script>

			</div>

						<div class="spacer"></div>
			<div class="trd-ph-embedded trd_blogpost_readmore" data-id="c1b5dcad-43be-4cfe-ba26-4b44aca4d54f"></div>

		</div><!-- container -->
	</div><!-- maincontent_wrap -->
		<!-- content ends -->

	<div class="social_float_wrap">
		<div class="container">
			<div class="match_blog_width">
				<div class="social_float">
					<a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/" class="social_float_link facebook" aria-label="Share on Facebook" data-toggle="tooltip" data-placement="top" data-title="Share on Facebook"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M13.69,24.903h3.679V15.999h2.454l.325-3.068H17.369l.004-1.536c0-.8.076-1.229,1.224-1.229h1.534V7.097H17.676c-2.949,0-3.986,1.489-3.986,3.992v1.842H11.852V16H13.69Z" /></svg></a>
					<a target="_blank" href="https://twitter.com/share?url=https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/&amp;text=Bucket%20Monopoly%3A%20Breaching%20AWS%20Accounts%20Through%20Shadow%20Resources" class="social_float_link twitter" aria-label="Share on X"  data-toggle="tooltip" data-placement="top" data-title="Share on X"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M18.05762,15.23193l5.87842-6.71875h-3.13867l-4.19336,4.79395-3.62549-4.79395h-5.8833l6.57324,8.59619-6.27393,7.1709h3.14014l4.6001-5.25684,4.02051,5.25684h5.74658l-6.84424-9.04834ZM10.94873,10.39209h1.04541l9.02197,11.92725h-.94434l-9.12305-11.92725Z" /></svg></a>
					<a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/&amp;title=Bucket%20Monopoly%3A%20Breaching%20AWS%20Accounts%20Through%20Shadow%20Resources" class="social_float_link linkedin" aria-label="Share on LinkedIn"  data-toggle="tooltip" data-placement="top" data-title="Share on Linkedin"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32"><path d="M24.299,22.932V16.795c0-3.288-1.755-4.818-4.096-4.818a3.52865,3.52865,0,0,0-3.206,1.768V12.228H13.439c.047,1.005,0,10.704,0,10.704h3.558V16.954a2.43146,2.43146,0,0,1,.117-.867,1.94665,1.94665,0,0,1,1.825-1.301c1.288,0,1.803.981,1.803,2.42v5.727l3.557-.001ZM9.69,10.767a1.8553,1.8553,0,1,0,.023-3.699,1.85409,1.85409,0,1,0-.045,3.698H9.69Zm1.779,12.165V12.228H7.912V22.932Z" /></svg></a>
				</div><!-- social_float -->
			</div><!-- match_blog_width -->
		</div><!-- container -->
	</div><!-- social_float_wrap -->



			<div class="toc_float_wrap is_pinned">
			<div class="container">
				<div class="match_blog_width">
					<div class="toc_float">

						<div class="toc_wrap">
							<div class="toc_title">Table of Contents</div>
						
							<ul><li><a id="tocitem_1" href="#section-1"><span data-contrast="none">Background</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_2" href="#section-2"><span data-contrast="none">Discovery</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_3" href="#section-3"><span data-contrast="none">Shadow Resource Attack Vector</span><span data-ccp-props="{&quot;201341983&quot;:0,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_4" href="#section-4">AWS CloudFormation Vulnerability: “cf-templates-{Hash}-{Region}”</a></li><li><a id="tocitem_5" href="#section-5"><span data-contrast="none">What If... the CloudFormation Bucket Is Already Taken by an Attacker? </span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_6" href="#section-6"><span data-contrast="none">What if… the Attacker Opens the Bucket for Public Access and Creates a Permissive Policy?</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_7" href="#section-7"><span data-contrast="none">What if… the Attacker Modifies the Template Files? </span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_8" href="#section-8"><span data-contrast="none">CloudFormation S3 Bucket Hash</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_9" href="#section-9"><span data-contrast="none">Exploring More Vulnerabilities</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_10" href="#section-10">AWS Glue Vulnerability: “aws-glue-assets-{Account-ID}-{Region}”</a></li><li><a id="tocitem_11" href="#section-11">AWS EMR Vulnerability: “aws-emr-studio-{Account-ID}-{Region}”</a></li><li><a id="tocitem_12" href="#section-12">AWS SageMaker Vulnerability: “sagemaker-{Region}-{Account-ID}”</a></li><li><a id="tocitem_13" href="#section-13">AWS CodeStar Vulnerability: “aws-codestar-{Region}-{Account-ID}”</a></li><li><a id="tocitem_14" href="#section-14">AWS Service Catalog Vulnerability: “cf-templates-{Hash}-{Region}”</a></li><li><a id="tocitem_15" href="#section-15"><span data-contrast="none">Shadow Resource Attack Vector in Open Source</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_16" href="#section-16"><span data-contrast="none">Past Services Affected by Shadow Resources</span><span data-ccp-props="{&quot;134233117&quot;:true,&quot;134233118&quot;:true,&quot;201341983&quot;:0,&quot;335559739&quot;:160,&quot;335559740&quot;:240}"> </span></a></li><li><a id="tocitem_17" href="#section-17"><span data-contrast="none">AWS account ID is a Secret</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_18" href="#section-18"><span class="TextRun MacChromeBold SCXW260985233 BCX0" lang="EN-US" xml:lang="EN-US" data-contrast="none"><span class="NormalTextRun SCXW260985233 BCX0" data-ccp-charstyle="Strong">Bucket Monopoly</span></span></a></li><li><a id="tocitem_19" href="#section-19"><span data-contrast="none">Bucket Monopoly Step-by-Step:</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:40,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_20" href="#section-20"><span data-contrast="none">How AWS address these vulnerabilities</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li><li><a id="tocitem_21" href="#section-21"><span data-contrast="none">Summary, Mitigations and Recommendations</span><span data-ccp-props="{&quot;134245418&quot;:true,&quot;134245529&quot;:true,&quot;201341983&quot;:0,&quot;335559738&quot;:240,&quot;335559739&quot;:0,&quot;335559740&quot;:259}"> </span></a></li></ul>						</div><!-- toc_wrap -->

					</div><!-- toc_float -->
				</div><!-- match_blog_width -->
			</div><!-- container -->
		</div><!-- toc_float_wrap -->

		<script type="text/javascript">
		var $j_st_toc = jQuery.noConflict();
		$j_st_toc(document).ready(function() {

			var $window_width = window.innerWidth ? window.innerWidth : $j_st_toc(window).width();

			if ($window_width >= 1023) { // Adjust the breakpoint as needed




				// toc float
				var tocFloatController = new ScrollMagic.Controller();
				var postPageWrap = $j_st_toc('.post_pagewrap');
				var tocFloatWrap = $j_st_toc('.toc_float_wrap');
				var postFooterMeta = $j_st_toc('#post_footer_meta');

				var tocfloat_scene = new ScrollMagic.Scene({
					triggerElement: postPageWrap[0],
					triggerHook: 0,
					offset: 0 // Start pinning from the very top of the page
				})
				.setPin(tocFloatWrap[0])
				.addTo(tocFloatController);

				// Add an additional scene to unpin the TOC when #post_footer_meta comes into view
				var unpin_scene = new ScrollMagic.Scene({
					triggerElement: postFooterMeta[0],
					triggerHook: 1 // Triggers when #post_footer_meta comes into view from the bottom
				})
				.on('enter', function() {
					tocFloatWrap.removeClass('is_pinned');
				})
				.on('leave', function() {
					tocFloatWrap.addClass('is_pinned');
				})
				.addTo(tocFloatController);

				

				// init tocSpyController
				var tocSpyController = new ScrollMagic.Controller();

				// build scenes
									new ScrollMagic.Scene({triggerElement: "#section_wrap_1",duration:$j_st_toc('#section_wrap_1').height()})
						.setClassToggle("#tocitem_1", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_2",duration:$j_st_toc('#section_wrap_2').height()})
						.setClassToggle("#tocitem_2", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_3",duration:$j_st_toc('#section_wrap_3').height()})
						.setClassToggle("#tocitem_3", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_4",duration:$j_st_toc('#section_wrap_4').height()})
						.setClassToggle("#tocitem_4", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_5",duration:$j_st_toc('#section_wrap_5').height()})
						.setClassToggle("#tocitem_5", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_6",duration:$j_st_toc('#section_wrap_6').height()})
						.setClassToggle("#tocitem_6", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_7",duration:$j_st_toc('#section_wrap_7').height()})
						.setClassToggle("#tocitem_7", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_8",duration:$j_st_toc('#section_wrap_8').height()})
						.setClassToggle("#tocitem_8", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_9",duration:$j_st_toc('#section_wrap_9').height()})
						.setClassToggle("#tocitem_9", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_10",duration:$j_st_toc('#section_wrap_10').height()})
						.setClassToggle("#tocitem_10", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_11",duration:$j_st_toc('#section_wrap_11').height()})
						.setClassToggle("#tocitem_11", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_12",duration:$j_st_toc('#section_wrap_12').height()})
						.setClassToggle("#tocitem_12", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_13",duration:$j_st_toc('#section_wrap_13').height()})
						.setClassToggle("#tocitem_13", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_14",duration:$j_st_toc('#section_wrap_14').height()})
						.setClassToggle("#tocitem_14", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_15",duration:$j_st_toc('#section_wrap_15').height()})
						.setClassToggle("#tocitem_15", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_16",duration:$j_st_toc('#section_wrap_16').height()})
						.setClassToggle("#tocitem_16", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_17",duration:$j_st_toc('#section_wrap_17').height()})
						.setClassToggle("#tocitem_17", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_18",duration:$j_st_toc('#section_wrap_18').height()})
						.setClassToggle("#tocitem_18", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_19",duration:$j_st_toc('#section_wrap_19').height()})
						.setClassToggle("#tocitem_19", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_20",duration:$j_st_toc('#section_wrap_20').height()})
						.setClassToggle("#tocitem_20", "active") // add class toggle
												.addTo(tocSpyController);
									new ScrollMagic.Scene({triggerElement: "#section_wrap_21",duration:$j_st_toc('#section_wrap_21').height()})
						.setClassToggle("#tocitem_21", "active") // add class toggle
												.addTo(tocSpyController);
				

			} //if width


		});

		</script>

	



</div><!-- post_pagewrap -->
</div><!-- page -->


<script type="text/javascript">
var $j_st_social = jQuery.noConflict();
$j_st_social(document).ready(function() {

	var $window_width = window.innerWidth ? window.innerWidth : $j_st_social(window).width();

	if ($window_width >= 1023) { // Adjust the breakpoint as needed

		//social float
		var socialFloatController = new ScrollMagic.Controller();
		var postPageWrap = $j_st_social('.post_pagewrap');
		var socialFloatWrap = $j_st_social('.social_float_wrap');
		var sceneDuration = postPageWrap.outerHeight() - socialFloatWrap.outerHeight() - 100; 
		var socialfloat_scene = new ScrollMagic.Scene({
			triggerElement: postPageWrap[0],
			duration: sceneDuration,
			triggerHook: 0
		})
		.setPin(socialFloatWrap[0])
		.addTo(socialFloatController);

		socialfloat_scene.on('enter', function() {
			socialFloatWrap.addClass('is_pinned');
		});

		socialfloat_scene.on('leave', function() {
			socialFloatWrap.removeClass('is_pinned');
		});

		
		$j_st_social('.social_float a').click(function() {
			window.open($j_st_social(this).attr('href'),'title', 'toolbar=no,scrollbars=no,resizable=yes,width=600,height=580');
			return false;
		});


		$j_st_social('[data-toggle="tooltip"]').each(function() {
			tooltip_title = $j_st_social(this).data('title');
			$j_st_social(this).tooltip({title: tooltip_title});
		});
		
	} //if width


});

</script>




<!-- script_box -->

			

	
	
<!-- footer_cta starts -->
	<div class="footer_cta_wrap is_glass animatable">
		<div class="se*ction">
			<div class="container">

				<div class="columns is-centered is-vcen*tered">

					<div class="column is-12 footer_cta">

													<div class="subtitle footer_cta_pretitle fadeInUp animationDelay_1">Need to secure enterprise workloads? </div>
						
						<div class="title footer_cta_title fadeInUp animationDelay_2">Aqua Cloud Native Application Protection Platform (CNAPP)</div>

													<div class="subtitle footer_cta_subtitle fadeInUp animationDelay_3">Go cloud native with the experts!</div>
						
						<a href="../../demo/index.html" class="button is-primary footer_cta_button fadeInUp animationDelay_4 dl_event_click"  data-dl-event="demo_footer" data-dl-category="request demo" data-dl-action="click button" data-dl-label="footer cta">Get Demo</a>					</div><!-- footer_cta -->

				</div><!-- columns -->


			</div><!-- container -->

		</div><!-- section -->
	</div><!-- footer_cta_wrap -->	
<!-- footer_cta ends -->


<!-- footer starts -->
<section class="footer_wrap animatable">
	<div class="section">

					<div class="columns is-multiline">

				<div class="column is-12 fadeInUp">
					<a class="footer_logo" href="../../index.html" title="Aqua Security">Aqua Security</a>
				</div>


				<div class="column is-4-widescreen is-5-desktop is-10-tablet is-12-mobile footer_1 fadeInUp animationDelay_1">
					Aqua Security is the pioneer in securing containerized cloud native applications from development to production. Aqua's full lifecycle solution prevents attacks by enforcing pre-deployment hygiene and mitigates attacks in real time in production, reducing mean time to repair and overall business risk. The Aqua Platform, a Cloud Native Application Protection Platform (CNAPP), integrates security from Code to Cloud, combining the power of agent and agentless technology into a single solution. With enterprise scale that doesn’t slow development pipelines, Aqua secures your future in the cloud. Founded in 2015, Aqua is headquartered in Boston, MA and Ramat Gan, IL protecting over 500 of the world’s largest enterprises. 

					<div class="g2_link_wrap">
						<a href="https://www.g2.com/products/aqua-security/reviews?utm_source=review-widget" target="_blank" title="Read reviews of Aqua Security on G2" rel="noreferrer"><img alt="Read Aqua Security reviews on G2" src="../../wp-content/themes/aqua3/images/g2_gray_8.png" width="300" height="151" loading="lazy" /></a>
											</div>

															<div class="social_links_wrap">
						<a href="https://www.instagram.com/aquaseclife/" class="social_link instagram" target="_blank" title="instagram" rel="noreferrer"></a>
						<a href="https://www.linkedin.com/company/aquasecteam" class="social_link linkedin" target="_blank" title="linkedin" rel="noreferrer"></a>
						<a href="https://www.youtube.com/c/AquasecTeam" class="social_link youtube" target="_blank" title="youtube" rel="noreferrer"></a>
						<a href="https://x.com/AquaSecurityHQ" class="social_link twitter" target="_blank" title="twitter" rel="noreferrer"></a>
						<a href="https://github.com/aquasecurity" class="social_link git" target="_blank" title="git" rel="noreferrer"></a>
						<a href="https://www.facebook.com/AquaSecTeam" class="social_link facebook" target="_blank" title="facebook" rel="noreferrer"></a>
											</div>

				</div><!-- column footer_1 -->
			
								<div class="column is-7-widescreen is-offset-1-widescreen is-7-desktop is-12-tablet is-12-mobile">

					<div class="columns is-multiline">

											<div class="column is-4-widescreen is-6-desktop is-6-tablet is-12-mobile footer_2 fadeInUp animationDelay_2">
																<div class="footer_link_group">
										<p>Use Cases</p>
										<ul class="menu">
											<li class="menu-item"><a href="../../use-cases/devops-security/index.html" >Automate DevSecOps</a></li><li class="menu-item"><a href="../../use-cases/cloud-workload-security/index.html" >Modernize Security</a></li><li class="menu-item"><a href="../../use-cases/cndr-cloud-native-detection-and-reponse/index.html" >CNDR Cloud Native Detection & Response</a></li><li class="menu-item"><a href="../../use-cases/container-auditing-compliance/index.html" >Compliance and Auditing</a></li><li class="menu-item"><a href="../../products/serverless-container-functions/index.html" >Serverless Containers & Functions</a></li><li class="menu-item"><a href="../../use-cases/multi-cloud-and-hybrid-cloud/index.html" >Hybrid and Multi Cloud</a></li><li class="menu-item"><a href="../../solutions/federal/index.html" >Federal Cloud Native Security</a></li>										</ul><!-- menu -->
									</div>
																		<div class="footer_link_group">
										<p>Environments</p>
										<ul class="menu">
											<li class="menu-item"><a href="../../products/kubernetes-security/index.html" >Kubernetes Security</a></li><li class="menu-item"><a href="../../solutions/red-hat-openshift-container-security/index.html" >OpenShift Security</a></li><li class="menu-item"><a href="../../solutions/aws-container-security/index.html" >AWS Security</a></li><li class="menu-item"><a href="../../solutions/azure-container-security/index.html" >Azure Cloud Security</a></li><li class="menu-item"><a href="../../solutions/google-cloud-kubernetes-security/index.html" >Google Cloud Security</a></li><li class="menu-item"><a href="../../solutions/vmware-tanzu/index.html" >Security for VMware Tanzu</a></li><li class="menu-item"><a href="../../solutions/docker-container-security/index.html" >Docker Security</a></li>										</ul><!-- menu -->
									</div>
																		<div class="footer_link_group">
										<p>Partners</p>
										<ul class="menu">
											<li class="menu-item"><a href="../../partners/index.html#technology-alliances" >Technology Partners</a></li><li class="menu-item"><a href="../../partners/index.html#partner-with-us" >Partner With Us</a></li>										</ul><!-- menu -->
									</div>
									
							


						</div><!-- column footer_2 -->

											<div class="column is-4-widescreen is-6-desktop is-6-tablet is-12-mobile footer_3 fadeInUp animationDelay_3">
																<div class="footer_link_group">
										<p>Resources</p>
										<ul class="menu">
											<li class="menu-item"><a href="../../research/index.html" >Aqua Security Research</a></li><li class="menu-item"><a href="../../cloud-native-academy/index.html" >The Cloud Native Wiki</a></li><li class="menu-item"><a href="../../cloud-native-academy/kubernetes-101/kubernetes-complete-guide/index.html" >Kubernetes 101</a></li><li class="menu-item"><a href="../../cloud-native-academy/cspm/aws-cloud-security/index.html" >AWS Cloud Security</a></li><li class="menu-item"><a href="../../cloud-native-academy/docker-container/index.html" >Docker 101</a></li><li class="menu-item"><a href="../../resources/virtual-container-security-channel/index.html" >The Cloud Native Channel</a></li><li class="menu-item"><a href="https://info.aquasec.com/kubernetes-security" >O’Reilly Book: Kubernetes Security</a></li><li class="menu-item"><a href="../../cloud-native-academy/cnapp/what-is-cnapp/index.html" >CNAPP 101</a></li><li class="menu-item"><a href="../../cloud-native-academy/cspm/cloud-security-posture-management-cspm/index.html" >CSPM 101</a></li>										</ul><!-- menu -->
									</div>
																		<div class="footer_link_group">
										<p>About Us</p>
										<ul class="menu">
											<li class="menu-item"><a href="../../about-us/index.html" >About Aqua</a></li><li class="menu-item"><a href="../../about-us/news/index.html" >Newsroom</a></li><li class="menu-item"><a href="../../about-us/careers/index.html" >Careers</a></li><li class="menu-item"><a href="../../brand/index.html" >Brand Guidelines</a></li><li class="menu-item"><a href="../../trust/security/index.html" >Trust & Security</a></li><li class="menu-item"><a href="../../aquarantee-cloud-native-protection-warranty/index.html" >Aqua Cloud Native Protection FAQ</a></li><li class="menu-item"><a href="../../services/index.html" >Professional services</a></li>										</ul><!-- menu -->
									</div>
																		<div class="footer_link_group">
										<p>Get in Touch</p>
										<ul class="menu">
											<li class="menu-item"><a href="../index.html" >Aqua Blog</a></li><li class="menu-item"><a href="../../about-us/contact-us/index.html" >Contact Us</a></li><li class="menu-item"><a href="https://success.aquasec.com/" >Success Portal</a></li>										</ul><!-- menu -->
									</div>
									
							


						</div><!-- column footer_3 -->

											<div class="column is-4-widescreen is-6-desktop is-6-tablet is-12-mobile footer_4 fadeInUp animationDelay_4">
																<div class="footer_link_group">
										<p>Products</p>
										<ul class="menu">
											<li class="menu-item"><a href="../../aqua-cloud-native-security-platform/index.html" >Cloud Native Security Platform</a></li><li class="menu-item"><a href="../../products/cspm/index.html" >CSPM Cloud Security</a></li><li class="menu-item"><a href="../../products/container-security/index.html" >Container Security</a></li><li class="menu-item"><a href="../../products/kubernetes-security/index.html" >Kubernetes Security</a></li><li class="menu-item"><a href="../../products/serverless-container-functions/index.html" >Serverless Security</a></li><li class="menu-item"><a href="../../products/cloud-vm-security/index.html" >Cloud VM Security</a></li><li class="menu-item"><a href="../../products/container-analysis/index.html" >Dynamic Threat Analysis (DTA)</a></li><li class="menu-item"><a href="../../products/container-vulnerability-scanning/index.html" >Container Vulnerability Scanning</a></li><li class="menu-item"><a href="../../products/open-source-projects/index.html" >Open Source Container Security</a></li><li class="menu-item"><a href="../../integrations/index.html" >Platform Integrations</a></li>										</ul><!-- menu -->
									</div>
									
															<a href="../../demo/index.html" class="button is-outlined neonbluearrowbutton is-spaced fadeInUp animationDelay_2 dl_event_click" target="_blank" data-dl-event="demo_footer" data-dl-category="demo" data-dl-action="click button" data-dl-label="footer">Get Started</a>
								


						</div><!-- column footer_4 -->

					
					</div><!-- columns -->
				</div><!-- column is-7 -->

			</div><!-- columns -->


		
		<div class="footer_copyright_wrap fadeInUp animationDelay_6">
					
			<div class="columns is-v*centered rev*erse-columns">
				
				<div class="column is-12">
						<div class="footer_copyright">
							Copyright &copy; 2024 Aqua Security Software Ltd. &nbsp; <a href="../../privacy/index.html">Privacy Policy</a> | <a href="../../terms-of-use/index.html">Terms of Use</a> | 
							
							<a class="cky-banner-element" title="Cookie Settings">Cookie Settings</a> | 

							&nbsp;<div class="dropdown accessibility_dropdown">
								<div class="dropdown-trigger">
									<a class="topbar_link accessibility" title="Open accessibility options">Accessibility Tools</a>
								</div>
								<div class="dropdown-menu accessibility_menu">
									<div class="dropdown-content">
										<a class="dropdown-item accessibility_text_link is-active" data-mode="text_normal" title="Normal text size">Normal text size</a>
										<a class="dropdown-item accessibility_text_link" data-mode="text_medium" title="Medium text size">Medium text size</a>
										<a class="dropdown-item accessibility_text_link" data-mode="text_large" title="Large text size">Large text size</a>
										<hr class="dropdown-divider">
										<a class="dropdown-item accessibility_display_link is-active" data-mode="display_normal" title="Normal display">Normal display</a>
										<a class="dropdown-item accessibility_display_link" data-mode="display_bw" title="Black & White display">Black & White display</a>
										<a class="dropdown-item accessibility_display_link" data-mode="display_dark" title="High contrast display">High contrast display</a>
										<hr class="dropdown-divider">
										<a class="dropdown-item accessibility_toggle_link" data-mode="stop_animations" title="Stop transitions and animations">Stop transitions and animations</a>
										<a class="dropdown-item accessibility_toggle_link" data-mode="show_underlines" title="Underline Links">Underline Links</a>
									</div><!-- dropdown-content" -->
								</div>
							</div><!-- dropdown hover -->


						</div>
				</div>

			</div><!-- columns -->

		</div><!-- footer_copyright_wrap -->
	
		
	</div><!-- section -->
</section>

<!-- footer ends -->

<!-- schema starts -->
<!-- schema ends -->

<!-- datalayer starts -->
<script type="text/javascript">
var $jdl1 = jQuery.noConflict();
$jdl1(document).ready(function(){

	if($jdl1(".dl_promo_click").length) {
		$jdl1(".dl_promo_click").click(function() {

			if(window.dataLayer) {

				dl_id = $jdl1(this).data('dl-id');
				//console.log("dl_id: " + dl_id);

				dl_name = $jdl1(this).data('dl-name');
				//console.log("dl_name: " + dl_name);

				dl_creative = $jdl1(this).data('dl-creative');
				//console.log("dl_creative: " + dl_creative);

				dl_position = $jdl1(this).data('dl-position');
				//console.log("dl_position: " + dl_position);

				dataLayer.push({
					'event': 'promotionClick',
					ecommerce: {
						promoClick: {
							promotions: [{
							'id': dl_id,
							'name': dl_name, 
							'creative': dl_creative,
							'position': dl_position
							}]
						}
					}
				});

			}; //if datalayer

			
		}); //dl_promo_click click
	}; //dl_promo_click length




	if($jdl1(".dl_event_click").length) {
		$jdl1(".dl_event_click").click(function() {

			if(window.dataLayer) {

				dl_event = $jdl1(this).data('dl-event');
				//console.log("dl_event: " + dl_event);

				dl_category = $jdl1(this).data('dl-category');
				//console.log("dl_category: " + dl_category);

				dl_action = $jdl1(this).data('dl-action');
				//console.log("dl_action: " + dl_action);

				dl_label = $jdl1(this).data('dl-label');
				//console.log("dl_label: " + dl_label);

				//console.log("------");
				//return false;
				dataLayer.push({
					'event': dl_event,
					'category': dl_category,
					'action': dl_action,
					'label': dl_label
				});

			}; //if datalayer

					
		}); //dl_event_click click
	}; //dl_event_click length

}); //jdl1
</script><!-- datalayer ends -->

<link rel='stylesheet' id='mediaelement-css' href='../../wp-includes/js/mediaelement/mediaelementplayer-legacy.min1f61.css?ver=4.2.17' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css' href='../../wp-includes/js/mediaelement/wp-mediaelement.minb6a4.css?ver=6.6.1' type='text/css' media='all' />
<script>window.lazyLoadOptions=[{elements_selector:"img[data-lazy-src],.rocket-lazyload,iframe[data-lazy-src]",data_src:"lazy-src",data_srcset:"lazy-srcset",data_sizes:"lazy-sizes",class_loading:"lazyloading",class_loaded:"lazyloaded",threshold:300,callback_loaded:function(element){if(element.tagName==="IFRAME"&&element.dataset.rocketLazyload=="fitvidscompatible"){if(element.classList.contains("lazyloaded")){if(typeof window.jQuery!="undefined"){if(jQuery.fn.fitVids){jQuery(element).parent().fitVids()}}}}}},{elements_selector:".rocket-lazyload",data_src:"lazy-src",data_srcset:"lazy-srcset",data_sizes:"lazy-sizes",class_loading:"lazyloading",class_loaded:"lazyloaded",threshold:300,}];window.addEventListener('LazyLoad::Initialized',function(e){var lazyLoadInstance=e.detail.instance;if(window.MutationObserver){var observer=new MutationObserver(function(mutations){var image_count=0;var iframe_count=0;var rocketlazy_count=0;mutations.forEach(function(mutation){for(var i=0;i<mutation.addedNodes.length;i++){if(typeof mutation.addedNodes[i].getElementsByTagName!=='function'){continue}
if(typeof mutation.addedNodes[i].getElementsByClassName!=='function'){continue}
images=mutation.addedNodes[i].getElementsByTagName('img');is_image=mutation.addedNodes[i].tagName=="IMG";iframes=mutation.addedNodes[i].getElementsByTagName('iframe');is_iframe=mutation.addedNodes[i].tagName=="IFRAME";rocket_lazy=mutation.addedNodes[i].getElementsByClassName('rocket-lazyload');image_count+=images.length;iframe_count+=iframes.length;rocketlazy_count+=rocket_lazy.length;if(is_image){image_count+=1}
if(is_iframe){iframe_count+=1}}});if(image_count>0||iframe_count>0||rocketlazy_count>0){lazyLoadInstance.update()}});var b=document.getElementsByTagName("body")[0];var config={childList:!0,subtree:!0};observer.observe(b,config)}},!1)</script><script data-no-minify="1" async src="../../wp-content/plugins/wp-rocket/assets/js/lazyload/17.8.3/lazyload.min.js"></script></body>

<!-- Mirrored from www.aquasec.com/blog/bucket-monopoly-breaching-aws-accounts-through-shadow-resources/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 31 Aug 2024 01:50:06 GMT -->
</html>

<!-- This website is like a Rocket, isn't it? Performance optimized by WP Rocket. Learn more: https://wp-rocket.me -->